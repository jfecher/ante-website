<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Language Tour</title>
<meta name="author" content="Jake Fecher" />




<meta name="keywords" content="ante, programming, language, antelang, lang">


<meta name="description" content="">

<meta name="generator" content="Hugo 0.89.0-DEV" />


<link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>


<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.11.2/css/all.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link href="/css/animate.css" rel="stylesheet">



  <link href="/css/style.red.css" rel="stylesheet" id="theme-stylesheet">



<link href="/css/custom.css?1710730933" rel="stylesheet">



  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->



<link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />


<link href="/css/owl.carousel.css" rel="stylesheet">
<link href="/css/owl.theme.css" rel="stylesheet">


<link rel="alternate" href="https://antelang.org/index.xml" type="application/rss+xml" title="Ante">







<meta property="og:updated_time" content="2021-03-01T00:00:00Z">



<meta name="twitter:card" content="summary">

<meta name="twitter:title" content="Language Tour">

<meta name="twitter:description" content="">


      <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Language Tour</title>
  <meta name="author" content="" />

  <meta name="keywords" content="ante, programming, language, antelang, lang">	
  <meta name="description" content="For exploring algebraic effects, safe shared mutability, and other novel features">

  <meta name="generator" content="Hugo 0.89.0-DEV" />

  <link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  
  <link href="https://antelang.org/css/animate.css" rel="stylesheet">

  
  
    <link href="https://antelang.org/css/style.red.css" rel="stylesheet" id="theme-stylesheet">
  


  
  <link href="https://antelang.org/css/custom.css" rel="stylesheet">
 
  
  <link rel="stylesheet" href="https://antelang.org/css/syntax.css">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="https://antelang.org/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="https://antelang.org/img/apple-touch-icon.png" />
  

  <link href="https://antelang.org/css/owl.carousel.css" rel="stylesheet">
  <link href="https://antelang.org/css/owl.theme.css" rel="stylesheet">

  <link rel="alternate" href="https://antelang.org/index.xml" type="application/rss+xml" title="Ante">

  
  <meta property="og:title" content="Language Tour" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://antelang.org/docs/language//" />
  <meta property="og:image" content="" />

  </head>

  <body>

    <div id="all">

        


        

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="https://antelang.org/">
                    <img src="https://antelang.org/img/ante_white.svg" width="90rem" alt="Language Tour" class="hidden-xs hidden-sm">
                    <img src="https://antelang.org/img/ante_white.svg" width="90rem" alt="Language Tour" class="visible-xs visible-sm">
                    <span class="sr-only">Language Tour - go to homepage</span>
                </a>
                
<div class="navbar-buttons">
        <div class="navbar-collapse collapse" id="navigation">
            <ul class="nav navbar-nav navbar-right">
            
            <li class="dropdown">
                <a href="https://antelang.org//docs/language">Documentation</a>
            </li>
            <li class="dropdown">
                <a href="https://antelang.org//docs/ideas">Ideas</a>
            </li>
            <li class="dropdown">
                <a href="https://antelang.org//docs/roadmap">Roadmap</a>
            </li>
            <li class="dropdown">
                <a href="https://antelang.org//blog">Blog</a>
            </li>

            <li class="dropdown">
                <a href="https://github.com/jfecher/ante"><i class="fa fa-15x fa-github"></i></a>
            </li>
            <li class="dropdown">
                <a href="https://reddit.com/r/ante"><i class="fab fa-15x fa-reddit"></i></a>
            </li>
            <li class="dropdown">
                <a href="https://discord.gg/NPJncGBAws"><i class="fab fa-15x fa-discord"></i></a>
            </li>
            <li class="dropdown">
                <a href="https://antelang.org//index.xml"><i class="fa fa-15x fa-rss"></i></a>
            </li>

            </ul>
        </div>
        <button type="button" class="navbar-toggle btn-template-main" onclick="document.getElementById('navigation').classList.toggle('collapse')">
    <span class="sr-only">Toggle Navigation</span>
        <i class="fa fa-align-justify"></i>
    </button>
</div>

            </div>
            

            
            

            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    






        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Language Tour</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">

                <div class="row">

                    

                    <div class="col-md-9" id="blog-post">

                        
                          <p class="text-muted text-uppercase mb-small text-right">
                            
                            
                            
                              
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                              2021-03-01
                            
                          </p>
                        

                        <div id="post-content">
                          <hr>
<p>Ante is a low-level impure functional programming language. It is low-level
in the sense that types are not boxed by default and programmers can still
delve down to optimize allocation/representation of memory if desired. A
central goal of ante however, is to not force this upon users and provide
sane defaults where possible.
Compared to other low-level languages, ante is safe like rust but tries
to be easier in general, for example by allowing shared mutability by
default and avoiding the need for lifetime annotations.</p>
<hr>
<h1 id="literals">Literals</h1>
<h2 id="integers">Integers</h2>
<p>Integer literals can be of any signed integer type (I8, I16,
I32, I64, Isz) or any unsigned integer type (U8, U16, U32, U64, Usz) but by
default integer literals are <a href="#int-type">polymorphic</a>. Integers come in
different sizes given by the number in their type that specifies
how many bits they take up. <code>Isz</code> and <code>Usz</code> are the signed and unsigned
integer types respectively of the same size as a pointer.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// Integer Literals are polymorphic, so if we don&#39;t specify their</span>
<span class="c1">// type via a suffix then we can use them with any other integer type.</span>
<span class="mi">100</span> <span class="o">+</span> <span class="mi">1usz</span> <span class="o">==</span> <span class="mi">101</span>

<span class="c1">// Type error: operands of &#39;+&#39; must be of the same type</span>
<span class="mi">3i8</span> <span class="o">+</span> <span class="mi">3u8</span>

<span class="c1">// Large numbers can use _ to separate digits</span>
<span class="mi">1_000_000</span>
<span class="mi">54_000_000_u64</span>
</code></pre></div><h2 id="floats">Floats</h2>
<p>Floats in ante conform to the IEEE 754 standard for floating-point arithmetic
and come in two varieties: <code>F32</code> and <code>F64</code> for 32-bit floats and 64-bit
floats respectively. Floats have a similar syntax to integers, but with
a <code>.</code> separating the decimal digits.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="mf">3.0</span> <span class="o">+</span> <span class="mf">4.5</span> <span class="o">/</span> <span class="mf">1.5</span>

<span class="c1">// 32-bit floats can be created with the F32 suffix</span>
<span class="mf">3.0f32</span>
</code></pre></div><p>Like integers, floating-point literals are also <a href="#float-type">polymorphic</a>.
If no type is specified they will default to <code>F64</code>.</p>
<h2 id="booleans">Booleans</h2>
<p>Ante also has boolean literals which are of the <code>Bool</code> type and can be either
<code>true</code> or <code>false</code>.</p>
<h2 id="characters">Characters</h2>
<p>Characters in ante are a single, 32-bit <a href="http://www.unicode.org/glossary/#unicode_scalar_value">Unicode scalar value</a>.
Note that since <code>String</code>s are UTF-8, multiple characters are packed into strings and if
the string contains only ASCII characters, its size in memory is 1 byte per character in the string.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">print</span> <span class="sc">&#39;H&#39;</span>
<span class="nf">print</span> <span class="sc">&#39;i&#39;</span>
</code></pre></div><p>Character escapes can also be used to represent characters not on a traditional keyboard:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="sc">&#39;</span><span class="se">\n</span><span class="sc">&#39;</span> <span class="c1">// newline</span>
<span class="sc">&#39;</span><span class="se">\r</span><span class="sc">&#39;</span> <span class="c1">// carriage-return</span>
<span class="sc">&#39;</span><span class="se">\t</span><span class="sc">&#39;</span> <span class="c1">// tab</span>
<span class="sc">&#39;</span><span class="se">\0</span><span class="sc">&#39;</span> <span class="c1">// null character</span>

<span class="sc">&#39;</span><span class="se">\xFFFF</span><span class="sc">&#39;</span> <span class="c1">// an arbitrary Unicode scalar value given by the</span>
         <span class="c1">// number &#39;FFFF&#39; in hex</span>
</code></pre></div><h2 id="strings">Strings</h2>
<p>Strings in ante are utf-8 by default and are represented via a pointer and
length pair. For efficient sub-string operations, strings are not null-terminated.
If desired, C-style null-terminated strings can be obtained by calling the <code>c_string</code> function.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">print</span> <span class="s">&#34;Hello, World!&#34;</span>

<span class="c1">// The String type is equivalent to the following struct:</span>
<span class="k">type</span> <span class="kt">String</span> <span class="ow">=</span>
    <span class="n">data</span><span class="o">:</span> <span class="kt">Ptr</span> <span class="kt">Char</span>
    <span class="n">len</span><span class="o">:</span> <span class="kt">Usz</span>

<span class="c1">// C-interop often requires using the `c_string` function:</span>
<span class="nf">c_string</span> <span class="p">(</span><span class="n">s</span><span class="o">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">:</span> <span class="kt">CString</span> <span class="ow">=</span> <span class="o">...</span>

<span class="k">extern</span> <span class="n">puts</span> <span class="o">:</span> <span class="kt">CString</span> <span class="ow">-&gt;</span> <span class="kt">I32</span>
<span class="nf">puts</span> <span class="p">(</span><span class="n">c_string</span> <span class="s">&#34;Hello, C!&#34;</span><span class="p">)</span>
</code></pre></div><h2 id="string-interpolation">String Interpolation</h2>
<p>Ante supports string interpolation via <code>$</code> or <code>${...}</code> within a string. Within
the brackets, arbitrary expressions will be converted to strings and spliced
at that position in the string as a whole.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">name</span> <span class="ow">=</span> <span class="s">&#34;Ante&#34;</span>
<span class="nf">print</span> <span class="s">&#34;Hello, $name!&#34;</span>
<span class="c1">//=&gt; Hello, Ante!</span>

<span class="nf">offset</span> <span class="ow">=</span> <span class="mi">4</span>
<span class="nf">print</span> <span class="s">&#34;The ${offset}th number after 3 is ${3 + offset}&#34;</span>
<span class="c1">//=&gt; The 4th number after 3 is 7</span>

</code></pre></div><hr>
<h1 id="variables">Variables</h1>
<p>Variables are immutable by default and can be created via <code>=</code>.
Also note that ante is strongly, statically typed yet we do not
need to specify the types of variables.
This is because ante has global <a href="#type-inference">type inference</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">n</span> <span class="ow">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">4</span>
<span class="nf">name</span> <span class="ow">=</span> <span class="s">&#34;Alice&#34;</span>

<span class="c1">// We can optionally specify a variable&#39;s type with `:`</span>
<span class="nf">reading_about_variables</span><span class="o">:</span> <span class="kt">Bool</span> <span class="ow">=</span> <span class="kc">true</span>
</code></pre></div><h2 id="mutability">Mutability</h2>
<p>A variable can be made mutable by adding the <code>mut</code> keyword when defining the variable:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// Mutable variables can be created with `mut`:</span>
<span class="nf">pet_name</span> <span class="ow">=</span> <span class="k">mut</span> <span class="s">&#34;Ember&#34;</span>
<span class="nf">print</span> <span class="n">pet_name</span>  <span class="c1">//=&gt; Ember</span>

<span class="c1">// And can be mutated with `:=`</span>
<span class="nf">pet_name</span> <span class="o">:=</span> <span class="s">&#34;Cinder&#34;</span>
<span class="nf">print</span> <span class="n">pet_name</span>  <span class="c1">//=&gt; Cinder</span>
</code></pre></div><p>Here&rsquo;s another example showing a function that can mutate the passed in parameter:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">count_evens</span> <span class="n">array</span> <span class="n">counter</span> <span class="ow">=</span>
    <span class="n">for</span> <span class="n">array</span> <span class="k">fn</span> <span class="n">elem</span> <span class="ow">-&gt;</span>
        <span class="k">if</span> <span class="n">even</span> <span class="n">elem</span> <span class="k">then</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nf">counter</span> <span class="ow">=</span> <span class="k">mut</span> <span class="mi">0</span>
<span class="nf">count_evens</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">counter</span><span class="p">)</span>

<span class="nf">print</span> <span class="n">counter</span>  <span class="c1">//=&gt; 2</span>
</code></pre></div><p>If you have a mutable struct, you can also transfer this mutability to its
fields to mutate them directly. This can be done via the <code>.&amp;</code> operator to retrieve
a reference to a field:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">my_pair</span> <span class="ow">=</span> <span class="k">mut</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nf">my_pair</span><span class="o">.&amp;</span><span class="n">first</span> <span class="o">:=</span> <span class="mi">3</span>

<span class="nf">field_ref</span> <span class="ow">=</span> <span class="n">my_pair</span><span class="o">.&amp;</span><span class="n">second</span>
<span class="nf">field_ref</span> <span class="o">:=</span> <span class="mi">4</span>

<span class="nf">print</span> <span class="n">my_pair</span>  <span class="c1">//=&gt; 3, 4</span>

<span class="c1">// The following two lines give an error because we never declared `bad` to be mutable</span>
<span class="nf">bad</span> <span class="ow">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="nf">bad</span><span class="o">.&amp;</span><span class="n">first</span> <span class="o">:=</span> <span class="mi">3</span>
</code></pre></div><h1 id="functions">Functions</h1>
<p>Functions in ante are also defined via <code>=</code> and are just syntactic
sugar for assigning a lambda for a variable. That is, <code>foo1</code> and <code>foo2</code>
below are exactly equivalent except for their name.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">foo1</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span>
    <span class="n">print</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>

<span class="nf">foo2</span> <span class="ow">=</span> <span class="k">fn</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span>
    <span class="n">print</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
</code></pre></div><p>Since ante is impure, combining effects can trivially be done via sequencing
two expressions which can be done by separating the expressions with a newline.
<code>;</code> can also be used to sequence two expressions on the same line if needed.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// We can specify parameter types and the</span>
<span class="c1">// function return type via `:`</span>
<span class="nf">foo1</span> <span class="p">(</span><span class="n">a</span><span class="o">:</span> <span class="kt">U32</span><span class="p">)</span> <span class="p">(</span><span class="n">b</span><span class="o">:</span> <span class="kt">U32</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="ow">=</span>
    <span class="n">print</span> <span class="n">a</span>
    <span class="n">print</span> <span class="n">b</span>
    <span class="n">print</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
</code></pre></div><hr>
<h1 id="type-inference">Type Inference</h1>
<p>Types almost never need to be manually specified due to the global type inference
algorithm which is based on an extended version of Hindley-Milner with let-polymorphism,
multi-parameter typeclasses (traits) and a limited form of functional dependencies.</p>
<p>This means ante can infer variable types, parameter types, function return types, and
even infer which traits are needed in generic function signatures.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// Something is iterable if we can call `next` on it and</span>
<span class="c1">// get either Some element and the rest of the iterator or</span>
<span class="c1">// None and we finish iterating</span>
<span class="k">trait</span> <span class="kt">Iterator</span> <span class="n">it</span> <span class="ow">-&gt;</span> <span class="n">elem</span> <span class="ow">=</span>
    <span class="n">next</span><span class="o">:</span> <span class="n">it</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>

<span class="nf">first_equals_two</span> <span class="n">it</span> <span class="ow">=</span>
    <span class="k">match</span> <span class="n">next</span> <span class="n">it</span>
    <span class="o">|</span> <span class="kt">Some</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kc">true</span>
    <span class="o">|</span> <span class="n">_</span> <span class="ow">-&gt;</span> <span class="kc">false</span>
</code></pre></div><p>We never gave any type for <code>first_equals_two</code> yet ante infers its type for us as
<code>a -&gt; Bool given Iterator a I32</code> - that is a function that returns a <code>Bool</code> and takes
a generic parameter of type <code>a</code> which must be an iterator producing elements of type <code>I32</code>.</p>
<hr>
<h1 id="significant-whitespace">Significant Whitespace</h1>
<p>Ante uses significant whitespace to help declutter source code and prevent bugs
(such as Apple&rsquo;s infamous
<a href="https://nakedsecurity.sophos.com/2014/02/24/anatomy-of-a-goto-fail-apples-ssl-bug-explained-plus-an-unofficial-patch/">goto fail</a>
bug). In general, ante tries to be simple with its whitespace semantics:
if the next line is indented 2+ or more spaces from the previous non-commented line
then an indent token is issued. If the lines differ by only 1 space then it is
considered to be a mistake and an error is issued. There is no notion of indenting
to or past an exact column like in Haskell&rsquo;s <a href="https://www.haskell.org/onlinereport/haskell2010/haskellch10.html#x17-17800010.3">offside rule</a>.</p>
<p>Secondly, anytime an unindent to a previous column occurs, an unindent token is issued.
Indents and unindents follow a stack discipline, each unindent is a return to a previous
indentation level rather than to a new one. So the following program is invalid since the
<code>else</code> was not unindented to the previous indent level.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">if</span> <span class="kc">true</span> <span class="k">then</span>
        <span class="n">print</span> <span class="s">&#34;foo&#34;</span>
    <span class="k">else</span>
        <span class="n">print</span> <span class="s">&#34;bar&#34;</span>
</code></pre></div><p>Thirdly, when a newline between two lines of code at the same indent level occurs,
a newline token is issued to separate the two expressions.</p>
<p>From these three rules we get <code>Indent</code>, <code>Unindent</code>, and <code>Newline</code> tokens which the
parser can parse just as if they were <code>{</code>, <code>}</code>, and <code>;</code> tokens in the source program.</p>
<h2 id="line-continuations">Line Continuations</h2>
<p>With the above 3 rules the syntax is transformed into one with the equivalent of
explicit <code>{</code>, <code>}</code>, and <code>;</code> tokens. ~95% of programs just work now and ante could stop
there if it wanted to, and for a long time it did. A problem arises however with the
third rule of using newlines as <code>;</code> tokens. Sometimes, users may wish to continue an
expression onto multiple lines. This is a problem with parallels of automatic semicolon
insertion in other languages. The main difference being ante also has significant whitespace
to help it clue into this problem.</p>
<p>Ante&rsquo;s original solution was more of a band-aid. It followed the python example of continuing
lines with <code>\</code> at the end of a line which would tell the lexer not to issue a newline token.
There was also a similar rule for elliding newlines while we were inside <code>()</code> or <code>[]</code> pairs.
This solution was quite annoying in practice however. Ante is much more expression-oriented
than python and particularly when working the <a href="#pipeline-operators">pipeline operators</a> we would end up with a long
chain of lines ending with <code>\</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// x |&gt; f = f x in older versions of ante</span>
<span class="nf">data</span>  <span class="nf">\</span>
<span class="o">|&gt;</span> <span class="n">map</span> <span class="p">(</span><span class="n">_</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="nf">\</span>
<span class="o">|&gt;</span> <span class="n">filter</span> <span class="p">(</span><span class="n">_</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="nf">\</span>
<span class="o">|&gt;</span> <span class="n">max</span>

<span class="nf">a</span> <span class="ow">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span>  <span class="nf">\</span>
    <span class="mi">5</span> <span class="o">+</span> <span class="mi">4</span>    <span class="nf">\</span>
    <span class="o">*</span> <span class="n">data</span>

<span class="nf">what_a_long_function_name</span> <span class="nf">\</span>
    <span class="n">function_arg_with_long_name1</span> <span class="nf">\</span>
    <span class="n">function_arg_with_long_name2</span> <span class="nf">\</span>
    <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div><p>In practice this ugly bit of syntax tended to discourage the otherwise good practice of
splitting long lines onto multiple lines. Ante thus needed a better solution. The goals
of the new solution were to be unambiguous, ergnomic, match a developer&rsquo;s mental model
of their program, and to issue error messages if needed instead of silently inferring the wrong thing.</p>
<p>This was initially difficult to solve but eventually ante landed on a solution based upon the
observance that when programmers want to continue lines, they almost always use indentation
to do so. Thus, to continue an expression in ante, the continuation must just be indented and
you can continue to use that same indentation level if you need multiple lines.</p>
<p>This is done by tracking when an indent is expected in the lexer and
only issuing the indent (and following unindent) if so. Ante&rsquo;s grammar is designed in
such a way that the lexer only needs to look at the previous token to find out if it expects
an indent afterward or not. These tokens that may have indentation after them are <code>if</code>, <code>then</code>,
<code>else</code>, <code>while</code>, <code>for</code>, <code>do</code>, <code>match</code>, <code>with</code>, along with <code>=</code>, <code>-&gt;</code>, and the assignment operators.
Semantically, these are the tokens needed for if-expressions, loops, match expressions, definitions,
and assignments. This is the list of tokens the programmer would normally need an indent for a block
of code after - it is analogous to knowing when you need to type <code>{</code> in curly-braced languages.</p>
<p>Note that an important part of this being implemented entirely in the lexer is that operator precedence
after continued lines just works (it is harder than it may seem if continuation is a parser rule).</p>
<p>When the lexer sees an indent that without one of these tokens preceeding it, it does not issue
an indent token and also does not issue newline tokens for any expression at that same level of
ignored indentation. Note that this is tracked on a per-block basis, so if we wanted we could
also still use constructs like <code>if</code> inside these blocks with ignored indentation - since we&rsquo;d
be indenting to a new level and that new level would have the indent tokens issued as normal.</p>
<p>With this rule, we can continue any line just by indenting it. Here&rsquo;s the previous example again
with the new rule:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// |&gt; is actually the exception to the &#34;programmers typically indent</span>
<span class="c1">// continuation lines&#34; rule. Naively trying the following lines however</span>
<span class="c1">// shows us another nice property of the rules above: we get an error</span>
<span class="c1">// if we mess up.</span>
<span class="nf">data</span>
<span class="o">|&gt;</span> <span class="n">map</span> <span class="p">(</span><span class="n">_</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1">// error here, |&gt; has no lhs! We must continue the line by indenting it</span>
<span class="o">|&gt;</span> <span class="n">filter</span> <span class="p">(</span><span class="n">_</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span>
<span class="o">|&gt;</span> <span class="n">max</span>

<span class="c1">// Here&#39;s the fixed, indented version</span>
<span class="nf">map</span> <span class="n">data</span> <span class="p">(</span><span class="n">_</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="o">|&gt;</span> <span class="n">filter</span> <span class="p">(</span><span class="n">_</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span>
    <span class="o">|&gt;</span> <span class="n">max</span>

<span class="c1">// The other examples work as expected</span>
<span class="nf">a</span> <span class="ow">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span>
    <span class="mi">5</span> <span class="o">+</span> <span class="mi">4</span>
    <span class="o">*</span> <span class="n">data</span>

<span class="nf">what_a_long_function_name</span>
    <span class="n">function_arg_with_long_name1</span>
    <span class="n">function_arg_with_long_name2</span>
    <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div><hr>
<h1 id="operators">Operators</h1>
<p>Operators in ante are essentially infix functions, they&rsquo;re even
defined in <code>trait</code>s the same way many functions are. Here are some
standard one&rsquo;s you&rsquo;re probably used to:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// The standard set of numeric ops with operator precedence as you&#39;d expect</span>
<span class="k">trait</span> <span class="kt">Add</span> <span class="n">a</span> <span class="k">with</span>
    <span class="p">(</span><span class="o">+</span><span class="p">)</span><span class="o">:</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span>

<span class="k">trait</span> <span class="kt">Sub</span> <span class="n">a</span> <span class="k">with</span>
    <span class="p">(</span><span class="o">-</span><span class="p">)</span><span class="o">:</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span>

<span class="k">trait</span> <span class="kt">Mul</span> <span class="n">a</span> <span class="k">with</span>
    <span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="o">:</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span>

<span class="k">trait</span> <span class="kt">Div</span> <span class="n">a</span> <span class="k">with</span>
    <span class="p">(</span><span class="o">/</span><span class="p">)</span><span class="o">:</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span>

<span class="c1">// % is modulus, not remainder. So -3 % 5 == 2</span>
<span class="k">trait</span> <span class="kt">Mod</span> <span class="n">a</span> <span class="k">with</span>
    <span class="p">(</span><span class="o">%</span><span class="p">)</span><span class="o">:</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// Comparison operators are implemented in terms of the `Cmp` trait</span>
<span class="k">trait</span> <span class="kt">Cmp</span> <span class="n">a</span> <span class="k">with</span>
    <span class="n">compare</span><span class="o">:</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Ordering</span>

<span class="k">type</span> <span class="kt">Ordering</span> <span class="ow">=</span> <span class="o">|</span> <span class="kt">Lesser</span> <span class="o">|</span> <span class="kt">Equal</span> <span class="o">|</span> <span class="kt">Greater</span>

<span class="p">(</span><span class="o">&lt;</span><span class="p">)</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="n">compare</span> <span class="n">a</span> <span class="n">b</span> <span class="o">==</span> <span class="kt">Lesser</span>
<span class="p">(</span><span class="o">&gt;</span><span class="p">)</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="n">compare</span> <span class="n">a</span> <span class="n">b</span> <span class="o">==</span> <span class="kt">Greater</span>
<span class="p">(</span><span class="o">&lt;=</span><span class="p">)</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="n">compare</span> <span class="n">a</span> <span class="n">b</span> <span class="o">!=</span> <span class="kt">Greater</span>
<span class="p">(</span><span class="o">&gt;=</span><span class="p">)</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="n">compare</span> <span class="n">a</span> <span class="n">b</span> <span class="o">!=</span> <span class="kt">Lesser</span>
</code></pre></div><p>There are also various compound assignment operators for convenience
when mutating data (<code>+=</code>, <code>-=</code>, and friends).</p>
<p>Logical operators have their names spelled out fully:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">if</span> <span class="kc">true</span> <span class="k">and</span> <span class="kc">false</span> <span class="k">then</span> <span class="n">print</span> <span class="s">&#34;foo&#34;</span>

<span class="k">if</span> <span class="kc">false</span> <span class="k">or</span> <span class="kc">true</span> <span class="k">then</span> <span class="n">print</span> <span class="s">&#34;bar&#34;</span>

<span class="k">if</span> <span class="k">not</span> <span class="kc">false</span> <span class="k">then</span> <span class="n">print</span> <span class="s">&#34;baz&#34;</span>
</code></pre></div><p><code>and</code> binds tighter than <code>or</code>, so the following prints <code>true</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">if</span> <span class="kc">false</span> <span class="k">and</span> <span class="kc">true</span> <span class="k">or</span> <span class="kc">true</span> <span class="k">and</span> <span class="kc">true</span> <span class="k">then</span>
    <span class="n">print</span> <span class="kc">true</span>

<span class="c1">// parsed as:</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">false</span> <span class="k">and</span> <span class="kc">true</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="kc">true</span> <span class="k">and</span> <span class="kc">true</span><span class="p">)</span> <span class="k">then</span>
    <span class="n">print</span> <span class="kc">true</span>
</code></pre></div><p>Since fiddling with individual bits is not a common operation, there
are no bitwise operators. Instead there are functions in the
<code>Bits</code> module for dealing with bits.</p>
<h2 id="subscript-operator">Subscript Operator</h2>
<p>The subscript operator for retrieving elements out of a collection
is spelled <code>a#i</code> in ante. The more common <code>a[i]</code> syntax would be
ambiguous with a function call to a function <code>a</code> taking a single
argument that is a collection with 1 element <code>i</code>.</p>
<p><code>#</code> has a higher precedence than all other binary operators. The following
example shows how to average the first and second elements in an array for
example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">average_first_two</span> <span class="n">array</span> <span class="ow">=</span>
    <span class="p">(</span><span class="n">array</span><span class="o">#</span><span class="mi">0</span> <span class="o">+</span> <span class="n">array</span><span class="o">#</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</code></pre></div><h2 id="no-dereference-operator">No Dereference Operator</h2>
<p>Dereferencing pointers in ante is somewhat uncommon, so ante provides no pointer
dereference operator. Instead, you can use the <code>deref</code> function in the standard library.
If you need to access a struct field, <code>struct.field</code> in will work as expected regardless
of whether <code>struct</code> is a struct or a pointer to a struct.</p>
<h2 id="pipeline-operators">Pipeline Operators</h2>
<p>The pipeline operators <code>.</code> and <code>$</code> are sugar for function application and
serve to pipe the results from one function to the input of another.</p>
<p><code>x.f y</code> is equivalent to <code>f x y</code> and functions similar to method syntax
<code>x.f(y)</code> in object-oriented languages. It is left-associative so <code>x .f y .g z</code>
desugars to <code>g (f x y) z</code>. This operator is particularly useful for chaining
iterator functions:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// Parse a csv&#39;s data into a matrix of integers</span>
<span class="nf">parse_csv</span> <span class="p">(</span><span class="n">text</span><span class="o">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Vec</span> <span class="p">(</span><span class="kt">Vec</span> <span class="kt">I32</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">lines</span> <span class="n">text</span>
        <span class="o">.</span><span class="n">skip</span> <span class="mi">1</span>  <span class="c1">// Skip the column labels line</span>
        <span class="o">.</span><span class="n">split</span> <span class="s">&#34;,&#34;</span>
        <span class="o">.</span><span class="n">map</span> <span class="n">parse</span>
        <span class="o">.</span><span class="n">collect</span>
</code></pre></div><p>In contrast to <code>.</code>, <code>$</code> is right associative and applies a function on its
left to an argument on its right. Where <code>.</code>
is used mostly to spread operations across multiple lines, <code>$</code> is often
used for getting rid of parenthesis on one line.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">print</span> <span class="p">(</span><span class="n">sqrt</span> <span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1">// Could also be written as:</span>
<span class="nf">print</span> <span class="o">$</span> <span class="n">sqrt</span> <span class="o">$</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div><h2 id="pair-operator">Pair Operator</h2>
<p>Ante does not have tuples, instead it provides a right-associative pair
operator <code>,</code> to construct a value of the pair type. We can use it like
<code>1, 2, 3</code> to construct a value of type <code>I32, I32, I32</code>
which in turn is just sugar for <code>Pair I32 (Pair I32 I32)</code>.</p>
<p>Compared to tuples, pairs are:</p>
<ol>
<li>Simpler: They do not need to be built into the compiler or its type
system. Instead, they can be defined as a normal struct type in the standard
library:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">type</span> <span class="kt">Pair</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="n">first</span><span class="o">:</span> <span class="n">a</span><span class="p">,</span> <span class="n">second</span><span class="o">:</span> <span class="n">b</span>
</code></pre></div><ol start="2">
<li>Easier to work with: Because pairs are just normal data types, we get
all the capabilities of normal types for free. For example, we know all pairs
will have exactly two fields. This makes creating <code>impl</code>s for them much easier.
Lets compare the task of converting a tuple to a string with doing the same for pairs.
With tuples we must <a href="https://hackage.haskell.org/package/base-4.14.1.0/docs/src/GHC.Show.html#line-268">create a different impl for every possible tuple size</a>.
with pairs on the other hand the simple implementation works for all sizes:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">cast_pair_string</span> <span class="ow">=</span> <span class="k">impl</span> <span class="kt">Cast</span> <span class="p">(</span><span class="kt">Pair</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="kt">String</span> <span class="n">via</span>
    <span class="n">cast</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=</span> <span class="s">&#34;$a, $b&#34;</span>
</code></pre></div><ol start="3">
<li>
<p>Just as efficient: both pairs and tuples have roughly the same representation
in memory (the exact same if you discount allignment differences).</p>
</li>
<li>
<p>More composable: having the right-associative <code>,</code> operator means we can
easily combine pairs or add an element if needed. For example, if we had a function
<code>unzip : List (a, b) -&gt; List a, List b</code>, we could use <code>unzip</code> even on a <code>List (a, b, c)</code>
to extract a <code>List a, List (b, c)</code> for us. This means if we wanted, we may implement
<code>unzip3</code> using <code>unzip</code> (though this would likely be inefficient):</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// given we have unzip : List (a, b) -&gt; List a, List b</span>
<span class="nf">unzip3</span> <span class="p">(</span><span class="n">list</span><span class="o">:</span> <span class="kt">List</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">:</span> <span class="kt">List</span> <span class="n">a</span><span class="p">,</span> <span class="kt">List</span> <span class="n">b</span><span class="p">,</span> <span class="kt">List</span> <span class="n">c</span> <span class="ow">=</span>
        <span class="n">as</span><span class="p">,</span> <span class="n">bcs</span> <span class="ow">=</span> <span class="n">unzip</span> <span class="n">list</span>
        <span class="n">bs</span><span class="p">,</span> <span class="n">cs</span> <span class="ow">=</span> <span class="n">unzip</span> <span class="n">bcs</span>
        <span class="n">as</span><span class="p">,</span> <span class="n">bs</span><span class="p">,</span> <span class="n">cs</span>
</code></pre></div><ul>
<li>
<p>Another place this shows up in is when deconstructing pair values.
Lets say we wanted to define a function <code>first</code> for getting the first
element of any tuple of length &gt;= 2 (remember, we are using nested pairs,
so there are no 1-tuples!), and <code>third</code> for getting the third
element of any tuple of length &gt;= 3. We can define the functions:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">first</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">a</span>
<span class="nf">third</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">=</span> <span class="n">c</span>


<span class="nf">first</span> <span class="p">(</span><span class="s">&#34;one&#34;</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#34;one&#34;</span>


<span class="nf">third</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#34;two&#34;</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="s">&#34;4&#34;</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="s">&#34;4&#34;</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">)</span>


<span class="c1">// so the parser will parse `third` and the call as follows:</span>
<span class="c1">//</span>
<span class="c1">// third (_, (_, c)) = c</span>
<span class="c1">// third (1, (&#34;two&#34;, (3.0, (&#34;4&#34;, 5.5)))) == (3.0, (&#34;4&#34;, 5.5))</span>
</code></pre></div><p>Note that to work with nested pairs of any length &gt;= 3 instead of &gt;= 4, our implementation of
<code>third</code> will really return a nested pair of <code>(third, rest...)</code> for
pairs of length &gt; 3. This is usually what we want when working with
generic code (since it also works with nested pairs of exactly length 3 and
enables the nice syntax in the next section).</p>
</li>
</ul>
<p>One last minor advantage of pairs is that we can use the fact that <code>,</code> is
right-associative to avoid some extra parenthesis compared to if we had tuples.
A common example is when enumerating a tuple, most languages would need two sets
of parenthesis but in ante since tuples are just nested pairs you can just add another <code>,</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">pairs</span> <span class="ow">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>

<span class="c1">// Other languages require deconstructing with nested parenthesis:</span>
<span class="nf">for</span> <span class="p">(</span><span class="n">enumerate</span> <span class="n">pairs</span><span class="p">)</span> <span class="k">fn</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">))</span> <span class="ow">-&gt;</span>
    <span class="n">print</span> <span class="s">&#34;Iteration $i: sum = ${one + two}&#34;</span>

<span class="c1">// But since `,` is just a normal operator,</span>
<span class="c1">// the following version is equally valid</span>
<span class="nf">for</span> <span class="p">(</span><span class="n">enumerate</span> <span class="n">pairs</span><span class="p">)</span> <span class="k">fn</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">)</span> <span class="ow">-&gt;</span>
    <span class="n">print</span> <span class="s">&#34;Iteration $i: sum = ${one + two}&#34;</span>
</code></pre></div><p>Finally, its necessary to mention that the earlier <code>Cast</code> example printed nested
pairs as <code>1, 2, 3</code> where as the <code>Show</code> instances in haskell printed tuples as <code>(1, 2, 3)</code>.
If we wanted to surround our nested pairs with parenthesis we have to work a bit
harder by having a helper trait so we can specialize the impl for pairs:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">trait</span> <span class="kt">ToStringHelper</span> <span class="n">t</span> <span class="k">with</span>
    <span class="n">to_string_helper</span> <span class="p">(</span><span class="n">x</span><span class="o">:</span> <span class="n">t</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">String</span> <span class="ow">=</span> <span class="n">cast</span> <span class="n">x</span>

<span class="nf">cast_pair_string</span> <span class="ow">=</span> <span class="k">impl</span>
    <span class="kt">Cast</span> <span class="p">(</span><span class="kt">Pair</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="kt">String</span> <span class="n">via</span>
        <span class="n">cast</span> <span class="n">pair</span> <span class="ow">=</span> <span class="s">&#34;(${to_string_helper pair})&#34;</span>

    <span class="c1">// Specialize the impl for pairs so we can recurse on the rhs</span>
    <span class="kt">ToStringHelper</span> <span class="p">(</span><span class="kt">Pair</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="n">via</span>
        <span class="n">to_string_helper</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=</span> <span class="s">&#34;$a, ${to_string_helper b}&#34;</span>
</code></pre></div><p>And these two functions will cover all possible lengths of nested pairs.</p>
<hr>
<h1 id="lambdas">Lambdas</h1>
<p>Lambdas in ante have the following syntax:
<code>fn arg1 arg2 ... argN -&gt; body</code>. Additionally a function definition
<code>foo a b c = body</code> is sugar for a variable assigned to
a lambda: <code>foo = fn a b c -&gt; body</code>. Lambdas can also capture part of
the variables in the scope they were declared. When they do this,
they are called closures:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">augend</span> <span class="ow">=</span> <span class="mi">2</span>
<span class="nf">data</span> <span class="ow">=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">100</span>

<span class="nf">map</span> <span class="n">data</span> <span class="k">fn</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">augend</span>
<span class="c1">//=&gt; 3, 4, 5, ..., 100, 101</span>
</code></pre></div><h2 id="explicit-currying">Explicit Currying</h2>
<p>While ante opts out of including implicit currying in favor of better
error messages, it does include an explicit version where arguments
of a function can be explicitly curried by placing <code>_</code> where that argument
would normally go. For example, in the following example, <code>f1</code> and <code>f2</code> are
equivalent:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">f1</span> <span class="ow">=</span> <span class="k">fn</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span>
<span class="nf">f2</span> <span class="ow">=</span> <span class="n">_</span> <span class="o">+</span> <span class="mi">2</span>
</code></pre></div><p>Compared to implicit currying, explicit currying lets us curry function
arguments in whatever order we want:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">add3</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="ow">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span>

<span class="nf">g1</span> <span class="ow">=</span> <span class="n">add3</span> <span class="n">_</span> <span class="mi">0</span> <span class="n">_</span>

<span class="c1">// g1 is equivalent to:</span>
<span class="nf">g2</span> <span class="ow">=</span> <span class="k">fn</span> <span class="n">a</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="n">add3</span> <span class="n">a</span> <span class="mi">0</span> <span class="n">c</span>
</code></pre></div><p>Explicit currying only curries the innermost function, so using
it with nested function calls will yield a type error unless the
outermost function is expecting another function:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// Nesting _ like this gives a type error:</span>
<span class="c1">// add3 expects an integer argument but a function was given.</span>
<span class="nf">nested</span> <span class="ow">=</span> <span class="n">add3</span> <span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="n">_</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1">// To make nested a function, it needs to be rewritten as a lambda:</span>
<span class="nf">nested</span> <span class="ow">=</span> <span class="k">fn</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">add3</span> <span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1">// Or a function definition</span>
<span class="nf">nested</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">add3</span> <span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div><p><code>_</code> really shines when using higher order functions and iterators:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// Given a matrix of Vec (Vec I32), output a String formatted like a csv file</span>
<span class="nf">map</span> <span class="n">matrix</span> <span class="n">to_string</span>
  <span class="o">|&gt;</span> <span class="n">map</span> <span class="p">(</span><span class="n">join</span> <span class="n">_</span> <span class="s">&#34;,&#34;</span><span class="p">)</span> <span class="c1">// join columns with commas</span>
  <span class="o">|&gt;</span> <span class="n">join</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>        <span class="c1">// and join rows with newlines.</span>
</code></pre></div><hr>
<h1 id="control-flow">Control-Flow</h1>
<p>Ante&rsquo;s control flow keywords should be very familiar to any programmer used
to expression-based languages.</p>
<p>If expressions expect a boolean condition (there are no falsey values) and
conditionally evaluate and return the then branch if it is true, and the
else branch otherwise. The else branch may also be omitted - in that case
the whole expression returns the unit value. The if condition, then branch,
or else branch can either be single expressions or an indented block expression.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">three</span> <span class="ow">=</span> <span class="k">if</span> <span class="kc">false</span> <span class="k">then</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">3</span>

<span class="k">if</span> <span class="n">should_print</span> <span class="p">()</span> <span class="k">then</span>
    <span class="n">print</span> <span class="n">three</span>
</code></pre></div><h2 id="loops">Loops</h2>
<p>Ante does not include traditional for or while loops since these constructs usually require mutability to be useful. Instead, ante favors recursive functions like map, fold_left, and for (which iterates over an iterable type, much like foreach loops in most languages):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// The type of for is:</span>
<span class="c1">// for : a -&gt; (elem -&gt; Unit) -&gt; Unit given Iterator a elem</span>

<span class="nf">for</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span> <span class="n">print</span>   <span class="c1">// prints 0-9 inclusive</span>

<span class="nf">for</span> <span class="p">(</span><span class="n">enumerate</span> <span class="n">array</span><span class="p">)</span> <span class="k">fn</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span> <span class="ow">-&gt;</span>
    <span class="c1">// do something more complex...</span>
    <span class="n">print</span> <span class="n">result</span>
</code></pre></div><p>You may notice that there is no way to break or continue out of the <code>for</code> function. Moreover if you need a more complex loop that a while loop may traditionally provide in other languages, there likely isn’t an already existing iterate function that would suit your need. Other functional languages usually use helper functions with recursion to address this problem:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">sum</span> <span class="n">numbers</span> <span class="ow">=</span>
    <span class="n">go</span> <span class="n">numbers</span> <span class="n">total</span> <span class="ow">=</span>
        <span class="k">match</span> <span class="n">numbers</span>
        <span class="o">|</span> <span class="kt">Nil</span> <span class="ow">-&gt;</span> <span class="n">total</span>
        <span class="o">|</span> <span class="kt">Cons</span> <span class="n">x</span> <span class="n">xs</span> <span class="ow">-&gt;</span> <span class="n">go</span> <span class="n">xs</span> <span class="p">(</span><span class="n">total</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>

    <span class="n">go</span> <span class="n">numbers</span> <span class="mi">0</span>
</code></pre></div><p>This can be cumbersome when you just want a quick loop in the middle of a function though. It is for this reason that ante provides the loop and recur keywords which are sugar for an immediately invoked helper function. The following definition of sum is exactly equivalent to the previous:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">sum</span> <span class="n">numbers</span> <span class="ow">=</span>
    <span class="k">loop</span> <span class="n">numbers</span> <span class="p">(</span><span class="n">total</span> <span class="ow">=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">-&gt;</span>
        <span class="k">match</span> <span class="n">numbers</span>
        <span class="o">|</span> <span class="kt">Nil</span> <span class="ow">-&gt;</span> <span class="n">total</span>
        <span class="o">|</span> <span class="kt">Cons</span> <span class="n">x</span> <span class="n">s</span> <span class="ow">-&gt;</span> <span class="k">recur</span> <span class="n">xs</span> <span class="p">(</span><span class="n">total</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div><p>After the loop keyword comes a list of variables/patterns which are translated into the parameters of the helper function. If these variables are already defined like numbers is above, then the value of that variable is used for the initial invocation of the helper function. Otherwise, if the variable/pattern isn’t already in scope then it must be supplied an initial value via =, as is the case with total in the above example. The body of the loop becomes the body of the recursive function, with recur standing in for the name of the function.</p>
<p>Since loop/recur uses recursion internally it is even more general than loops, and can be used to translate otherwise complex while loops into ante. Take for example this while loop which builds up a list of the number’s digits, mutating the number as it goes:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="n">list</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">get_digits</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">list</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">ret</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">last_digit</span> <span class="o">=</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">10</span><span class="p">;</span>
        <span class="n">ret</span><span class="p">.</span><span class="n">push_front</span><span class="p">(</span><span class="n">last_digit</span><span class="p">);</span>
        <span class="n">x</span> <span class="o">/=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>This can be translated into ante as the following loop:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">get_digits</span> <span class="p">(</span><span class="n">x</span><span class="o">:</span> <span class="kt">U32</span><span class="p">)</span> <span class="o">:</span> <span class="kt">List</span> <span class="kt">U32</span> <span class="ow">=</span>
    <span class="k">loop</span> <span class="n">x</span> <span class="p">(</span><span class="n">digits</span> <span class="ow">=</span> <span class="kt">Nil</span><span class="p">)</span> <span class="ow">-&gt;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span> <span class="k">return</span> <span class="n">digits</span>
        <span class="n">last_digit</span> <span class="ow">=</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">10</span>
        <span class="k">recur</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="kt">Cons</span> <span class="n">last_digit</span> <span class="n">digits</span><span class="p">)</span>
</code></pre></div><hr>
<h1 id="pattern-matching">Pattern Matching</h1>
<p>Pattern matching on algebraic data types can be done with a <code>match</code>
expression:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">match</span> <span class="n">foo</span>
<span class="o">|</span> <span class="kt">Some</span> <span class="n">bar</span> <span class="ow">-&gt;</span> <span class="n">print</span> <span class="n">bar</span>
<span class="o">|</span> <span class="kt">None</span> <span class="ow">-&gt;</span> <span class="p">()</span>
</code></pre></div><p>Since <code>match</code> is an expression, each branch must match type. The value
of the matched branch is evaluated and becomes the result of the whole
match expression. The compiler will also warn us if we forget a case
or include one that is redundant and will never be matched.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// Error: Missing case: Some None</span>
<span class="k">match</span> <span class="n">foo</span>
<span class="o">|</span> <span class="kt">Some</span> <span class="p">(</span><span class="kt">Some</span> <span class="n">bar</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="kt">None</span> <span class="ow">-&gt;</span> <span class="o">...</span>
</code></pre></div><p>In addition to the usual suspects (tagged-unions, structs, pairs), we can
also include literals and guards in our patterns and it will work as
we expect:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">type</span> <span class="kt">IntOrString</span> <span class="ow">=</span>
   <span class="o">|</span> <span class="kt">Int</span> <span class="kt">I32</span>
   <span class="o">|</span> <span class="kt">String</span> <span class="kt">String</span>

<span class="k">match</span> <span class="kt">Int</span> <span class="mi">7</span>
<span class="o">|</span> <span class="kt">Int</span> <span class="mi">3</span> <span class="ow">-&gt;</span> <span class="n">print</span> <span class="s">&#34;Found 3!&#34;</span>
<span class="o">|</span> <span class="kt">Int</span> <span class="n">n</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">-&gt;</span> <span class="n">print</span> <span class="s">&#34;Found a small Int!&#34;</span>
<span class="o">|</span> <span class="kt">String</span> <span class="s">&#34;hello&#34;</span> <span class="ow">-&gt;</span> <span class="n">print</span> <span class="s">&#34;Found a greeting!&#34;</span>
<span class="o">|</span> <span class="n">value</span> <span class="ow">-&gt;</span> <span class="n">print</span> <span class="s">&#34;Found something else: $value&#34;</span>
</code></pre></div><p>Note that there are a few subtle design decisions:</p>
<ol>
<li>
<p>All type constructors must be capitalized in ante, so when
we see a lower-case variable in a pattern match we know we
will always create a new variable rather than match on some
nullary constructor (like <code>None</code>).</p>
</li>
<li>
<p>Each pattern is prefixed with <code>|</code> rather than being indented like
in some other languages. Doing it this way means if we indent the
body as well, we only need to indent once past the <code>match</code> instead
of twice which saves us valuable horizontal space.</p>
</li>
</ol>
<hr>
<h1 id="types">Types</h1>
<p>Ante is a strongly, statically typed language with global type inference.
Types are used to restrict the set of values as best as possible such that
only valid values are representable. For example, since references in ante
cannot be null we can instead represent possibly null references with
<code>Maybe &amp;t</code> which makes it explicit whether a function can accept or
return possibly null values.</p>
<h2 id="type-definitions">Type Definitions</h2>
<p>Both struct and tagged union types can be defined with the
<code>type Name args = ...</code>construct where <code>args</code> is the space-separated
list of type variables the type is generic over.</p>
<p>You can define struct types with commas separating each field or
newlines if the type spans multiple lines:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">type</span> <span class="kt">Person</span> <span class="ow">=</span> <span class="n">name</span><span class="o">:</span> <span class="kt">String</span><span class="p">,</span> <span class="n">age</span><span class="o">:</span> <span class="kt">U8</span>

<span class="k">type</span> <span class="kt">Vec</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="n">data</span><span class="o">:</span> <span class="kt">Ptr</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
    <span class="n">len</span><span class="o">:</span> <span class="kt">Usz</span>
    <span class="n">capacity</span><span class="o">:</span> <span class="kt">Usz</span>
</code></pre></div><p>Tagged unions can be defined with <code>|</code>s separating each variant.
The <code>|</code> before the first variant is mandatory. Ante currently has
no support for untagged C unions.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">type</span> <span class="kt">Maybe</span> <span class="n">t</span> <span class="ow">=</span>
   <span class="o">|</span> <span class="kt">Some</span> <span class="n">t</span>
   <span class="o">|</span> <span class="kt">None</span>

<span class="k">type</span> <span class="kt">Result</span> <span class="n">t</span> <span class="n">e</span> <span class="ow">=</span>
   <span class="o">|</span> <span class="kt">Ok</span> <span class="n">t</span>
   <span class="o">|</span> <span class="kt">Err</span> <span class="n">e</span>
</code></pre></div><h2 id="type-annotations">Type Annotations</h2>
<p>Even with global type inference, there are still situations where
types need to be manually specified. For these cases, the <code>x : t</code>
type annotation syntax can be used. This is valid anywhere an expression
or irrefutable pattern is expected. It is often used in practice
for annotatiing parameter types and for deciding an unbounded generic
type - for example when parsing a value from a string then printing it.
Both operations are generic so we&rsquo;ll need to specify what type we should
parse out of the string:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">parse_and_print_int</span> <span class="p">(</span><span class="n">s</span><span class="o">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="ow">=</span>
    <span class="n">x</span> <span class="ow">=</span> <span class="n">parse</span> <span class="n">s</span> <span class="o">:</span> <span class="kt">I32</span>
    <span class="c1">// alternatively we could do</span>
    <span class="c1">// x: I32 = parse s</span>
    <span class="n">print</span> <span class="n">x</span>
</code></pre></div><h2 id="int-type">Int Type</h2>
<p>Ante has quite a few <a href="#integers">integer types</a> so one question
that gets raised is what is the type of an integer literal?
If we randomly choose a type like <code>I32</code> then when using all
other integer types we&rsquo;d have to constaintly annotate our
operations with the type used which can be annoying. Imagine
<code>a + 1u64</code> every few lines.</p>
<p>Instead, integer literals are given the polymorphic <code>Int a</code> type:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="mi">3</span> <span class="o">:</span> <span class="kt">Int</span> <span class="n">a</span> <span class="c1">// for some unknown &#39;a&#39; which will later be resolved</span>
          <span class="c1">// to one of I8, I16, ..., U8, U16, ... etc.</span>
</code></pre></div><p>When we use an integer with no specific type, the integer literal
keeps this generic type. This sometimes pops up in function signatures:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// This works with any integer type</span>
<span class="nf">add1</span> <span class="p">(</span><span class="n">x</span><span class="o">:</span> <span class="kt">Int</span> <span class="n">a</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Int</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div><p>If we do use it with a specific type however, then just like with
normal generics, the generic type variable is constrained to be
that concrete type (and the concrete type must satisfy the <code>Int</code>
constraint - ie it must be a primitive integer or we get a compile-time error).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// Fine, we&#39;re still generic over a</span>
<span class="nf">foo</span> <span class="p">()</span> <span class="o">:</span> <span class="kt">Int</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="mi">0</span>

<span class="nf">x</span><span class="o">:</span> <span class="kt">I32</span> <span class="ow">=</span> <span class="mi">1</span>  <span class="c1">// also fine, we constrained 1 : I32 now</span>

<span class="nf">y</span> <span class="ow">=</span> <span class="mi">2u16</span>  <span class="c1">// still fine, now we&#39;re specifying the type</span>
          <span class="c1">// of the integer literal directly</span>
</code></pre></div><h2 id="float-type">Float Type</h2>
<p>Like the <a href="#int-type">Int type</a>, there is also a polymorphic <code>Float a</code> type:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="mf">3.0</span>  <span class="c1">// has the type `Float a` until it is later used in an expression</span>
     <span class="c1">// which forces it to be either a F32 or F64.</span>
</code></pre></div><p>Values of the <code>Float a</code> type will default to <code>F64</code> if they are never constrained:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">print</span> <span class="mf">5.0</span>  <span class="c1">// Since we can print any float type, we arbitrarily default 5.0 to an F64</span>
           <span class="c1">// making this snippet equivalent to `print (5.0 : F64)`</span>
</code></pre></div><h2 id="anonymous-struct-types">Anonymous Struct Types</h2>
<p>If we have multiple types with the same field in scope:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">type</span> <span class="kt">A</span> <span class="ow">=</span> <span class="n">foo</span><span class="o">:</span> <span class="kt">I32</span>

<span class="k">type</span> <span class="kt">B</span> <span class="ow">=</span> <span class="n">foo</span><span class="o">:</span> <span class="kt">String</span>
</code></pre></div><p>Then we are left with the problem of deciding what the type
of an <code>x.foo</code> expression should be:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// Does this work?</span>
<span class="c1">// - If so what type do we get?</span>
<span class="c1">// - If not, what is the error?</span>
<span class="nf">get_foo</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">x</span><span class="o">.</span><span class="n">foo</span>
</code></pre></div><p>Ante solves this with anonymous struct types which are row-polymorphic.
In other words, they are polymorphic over what fields are in the struct,
which allows any struct type to be used so long as it has the required
fields. For example, <code>{ x: I32 }</code> would be the type of any struct that
has a field <code>x</code> of type <code>I32</code>.</p>
<p>Using this, we can type <code>get_foo</code> as a function which takes
any struct that has a field named <code>foo</code> of type <code>b</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">get_foo</span> <span class="p">(</span><span class="n">x</span><span class="o">:</span> <span class="p">{</span> <span class="n">foo</span><span class="o">:</span> <span class="n">b</span> <span class="p">})</span> <span class="o">:</span> <span class="n">b</span> <span class="ow">=</span>
    <span class="n">x</span><span class="o">.</span><span class="n">foo</span>
</code></pre></div><p>As a more complex example, here&rsquo;s a function that can print anything with <code>debug</code> field
that itself is printable and a <code>prefix</code> field that must be a string:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// Type inferred as:</span>
<span class="c1">//   { prefix: String, debug: a } -&gt; Unit given Print a</span>
<span class="nf">print_debug</span> <span class="n">x</span> <span class="ow">=</span>
    <span class="n">prefix</span> <span class="ow">=</span> <span class="n">x</span><span class="o">.</span><span class="n">prefix</span> <span class="o">++</span> <span class="s">&#34;: &#34;</span>
    <span class="n">print</span> <span class="n">prefix</span>
    <span class="n">print</span> <span class="n">x</span><span class="o">.</span><span class="n">debug</span>
</code></pre></div><hr>
<h1 id="move-semantics">Move Semantics</h1>
<p>Similar to Rust, values in Ante are affine by default (may be used 0 or 1 time
before they are dropped and deallocated). These values are called
&ldquo;owned&rdquo; values, in contrast with references which are &ldquo;borrowed&rdquo; and may be
used any amount of times. The only exception to owned values being used
at most once are types which implement the <code>Copy</code> trait. This trait signals
the type may be trivially copied each time it is referred to:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">s</span><span class="o">:</span> <span class="kt">String</span> <span class="ow">=</span> <span class="s">&#34;my string&#34;</span>
<span class="nf">x</span><span class="o">:</span> <span class="kt">I32</span> <span class="ow">=</span> <span class="mi">42</span>

<span class="c1">// We&#39;ve moved `s` into `foo`, trying to access it afterwards would give a compile-time error</span>
<span class="nf">foo</span> <span class="n">s</span> <span class="n">x</span>

<span class="c1">// Since I32 is a primitive type, we can still refer to `x` after it was passed into `foo`</span>
<span class="nf">bar</span> <span class="n">x</span>
</code></pre></div><h2 id="borrowing">Borrowing</h2>
<p>Like Rust, if a value needs to be used multiple times, we can borrow references
to it so that we can refer to the value as many times as we need.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">s</span> <span class="ow">=</span> <span class="s">&#34;my string&#34;</span>

<span class="c1">// References can be used as many times as needed</span>
<span class="nf">baz</span> <span class="o">&amp;</span><span class="n">s</span>
<span class="nf">baz</span> <span class="o">&amp;</span><span class="n">s</span>
</code></pre></div><p>Mutable references can be borrowed from mutable values using <code>&amp;mut</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">s</span> <span class="ow">=</span> <span class="k">mut</span> <span class="s">&#34;my string&#34;</span>

<span class="c1">// This function call may modify our string</span>
<span class="nf">qux</span> <span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">s</span><span class="p">)</span>

<span class="nf">print</span> <span class="n">s</span>  <span class="c1">//=&gt; &#34;???&#34;</span>
</code></pre></div><h3 id="restrictions-on-references">Restrictions on References</h3>
<p>Compared to references in Rust, Ante&rsquo;s references are also bound by lifetimes, although
this lifetime cannot be explicitly referred to by a lifetime variable. This is a tradeoff
which simplifies the language somewhat but means that the expressivity of references is
also more restricted compared to Rust. Generally, references are meant to mostly be used
as a parameter-passing method rather than stored deeply within types.</p>
<p>When used in a parameter position, each variable of a function is assumed to have a
possibly different lifetime:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">concat_foo</span> <span class="p">(</span><span class="n">foo</span><span class="o">:</span> <span class="o">&amp;</span><span class="kt">Foo</span><span class="p">)</span> <span class="o">:</span> <span class="kt">String</span> <span class="ow">=</span>
    <span class="n">foo</span><span class="o">.</span><span class="n">first</span> <span class="o">++</span> <span class="n">foo</span><span class="o">.</span><span class="n">second</span>
</code></pre></div><p>Taking a reference prevents moving the underlying value before the reference is dropped:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">bad</span> <span class="p">(</span><span class="n">foo</span><span class="o">:</span> <span class="kt">Foo</span><span class="p">)</span> <span class="ow">=</span>
    <span class="c1">// Error: Cannot move `foo` while the borrowed reference `&amp;foo` is still alive</span>
    <span class="n">bar</span> <span class="o">&amp;</span><span class="n">foo</span> <span class="n">foo</span>
</code></pre></div><h4 id="returning-references">Returning References</h4>
<p>The next most common use of references is writing functions to lend references
to avoid cloning the inner value unnecessarily. Other languages with
references approach this differently. In Hylo for example, references may only
be returned in special &ldquo;subscript&rdquo; functions, which are in turn only able to be
called within another function call, e.g. <code>foo(my_subscript(bar, baz), qux)</code>.</p>
<p>Ante recognizes this common case and tries to be more flexible in comparison.
Functions returning references are allowed:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">get_ref</span> <span class="p">(</span><span class="n">foo</span><span class="o">:</span> <span class="o">&amp;</span><span class="kt">Foo</span><span class="p">)</span> <span class="p">(</span><span class="n">_bar</span><span class="o">:</span> <span class="o">&amp;</span><span class="kt">Bar</span><span class="p">)</span> <span class="o">:</span> <span class="o">&amp;</span><span class="kt">Baz</span> <span class="ow">=</span>
    <span class="n">foo</span><span class="o">.&amp;</span><span class="n">baz</span>
</code></pre></div><p>If a reference is returned from a function, none of the referenced inputs
can be moved until the returned reference is dropped.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">example2</span> <span class="p">(</span><span class="n">foo</span><span class="o">:</span> <span class="kt">Foo</span><span class="p">)</span> <span class="p">(</span><span class="n">bar</span><span class="o">:</span> <span class="kt">Bar</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">ref</span> <span class="ow">=</span> <span class="n">get_ref</span> <span class="o">&amp;</span><span class="n">foo</span> <span class="o">&amp;</span><span class="n">bar</span>
    <span class="c1">// Error: Cannot move `foo` while `ref` is still alive</span>
    <span class="n">drop</span> <span class="n">foo</span>
    <span class="n">print</span> <span class="n">ref</span>
</code></pre></div><p>Since Ante has no lifetime annotations it does not know from which
variable the return result is borrowed from. To solve this, Ante conservatively
ties the lifetime of the return result to the lifetime of all of the reference
parameters to the function. In addition to not being able to move any of these
parameters afterward, this can also have implications for whether each reference
must be <code>shared</code> or not (see <a href="#shared-mutability">shared mutability</a>). Consider the following code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">example2</span> <span class="p">(</span><span class="n">foo</span><span class="o">:</span> <span class="kt">Foo</span><span class="p">)</span> <span class="p">(</span><span class="n">bar</span><span class="o">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="kt">Bar</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">ref</span> <span class="ow">=</span> <span class="n">get_ref</span> <span class="o">&amp;</span><span class="n">foo</span> <span class="n">bar</span>
    <span class="n">print</span> <span class="n">bar</span>
    <span class="n">print</span> <span class="n">ref</span>
    <span class="p">()</span>
</code></pre></div><p>We get an error that <code>bar</code> must be a <code>shared</code> reference because the compiler sees
<code>ref</code> as a reference potentially aliased to <code>bar</code>, which would make it mutably
aliased since <code>bar: &amp;mut Bar</code>. This is despite us being able to peek into <code>get_ref</code>
to see it actually only ever returns a reference inside of <code>foo</code>.</p>
<h4 id="lifetime-bound-types">Lifetime-bound Types</h4>
<p>Types which capture references must themselves be bound by the same lifetime as those
references. This is indicated using the <code>ref</code> keyword. For example, if we had a struct:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">type</span> <span class="kt">Context</span> <span class="ow">=</span>
    <span class="n">global_context</span><span class="o">:</span> <span class="o">&amp;</span><span class="kt">GlobalContext</span>
</code></pre></div><p>We would have to refer to this struct elsewhere as <code>ref Context</code>, which will restrict
the lifetime of the <code>Context</code> to that of the reference it contains internally. This is
similar to using a lifetime variable in Rust: <code>Context&lt;'a&gt;</code>.</p>
<p>If a type captures multiple references, the lifetime used by <code>Context</code> is the shortest
of all the captured lifetimes.</p>
<p><code>ref</code> is also often seen when using closures which capture references:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">x</span> <span class="ow">=</span> <span class="kt">Bar</span>
<span class="nf">foo</span> <span class="p">()</span> <span class="ow">=</span> <span class="n">x</span>

<span class="c1">// Type of foo is:  ref Fn Unit =&gt; &amp;Bar</span>
</code></pre></div><hr>
<h3 id="shared-mutability">Shared Mutability</h3>
<p>Another difference from Rust is that Ante allows shared (aliasable) mutability.
In addition to whether a reference is <code>mut</code>able or not, a reference can also
be tagged whether it is <code>own</code>ed or <code>shared</code>. Additionally, if there is a mutable
reference borrwed from a value with at least 1 other borrowed reference to the same
value, all references are inferred to be mutably <code>shared</code>.</p>
<p>The <code>own</code> and <code>shared</code> tags are used to prevent operations that would be unsafe
on a shared mutable reference. A common theme of these operations is that they hand
out references inside of a type with an unstable shape. For example, handing out
a reference to a <code>Vec</code> element would be unsafe in a shared context since the <code>Vec</code>
may be reallocated by another reference. To prevent this, <code>Vec.get</code> requires
an owned reference:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// Raises Fail if the index is out of bounds</span>
<span class="nf">get</span> <span class="p">(</span><span class="n">v</span><span class="o">:</span> <span class="o">&amp;</span><span class="k">own</span> <span class="kt">Vec</span> <span class="n">t</span><span class="p">)</span> <span class="p">(</span><span class="n">index</span><span class="o">:</span> <span class="kt">Usz</span><span class="p">)</span> <span class="o">:</span> <span class="o">&amp;</span><span class="k">own</span> <span class="n">t</span> <span class="k">can</span> <span class="kt">Fail</span>
</code></pre></div><p>Other Vec functions like <code>push</code> or <code>pop</code> would still be safe to call on <code>shared</code>
references to Vecs since they do not hand out references to elements. If we did
need a Vec element when all we have is a <code>&amp;shared Vec t</code>, we can still retrieve
an element through <code>Vec.get_cloned</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// Raises Fail if the index is out of bounds</span>
<span class="nf">get_cloned</span> <span class="p">(</span><span class="n">v</span><span class="o">:</span> <span class="o">&amp;</span><span class="kt">Vec</span> <span class="n">t</span><span class="p">)</span> <span class="p">(</span><span class="n">index</span><span class="o">:</span> <span class="kt">Usz</span><span class="p">)</span> <span class="o">:</span> <span class="o">&amp;</span><span class="n">t</span> <span class="k">can</span> <span class="kt">Fail</span> <span class="k">given</span> <span class="kt">Clone</span> <span class="n">t</span>
</code></pre></div><p>As a result, if you know you&rsquo;re going to be working with mutably shared Vecs
or other container types, you may want to wrap each element in a pointer type
to reduce the cost of cloning: <code>Vec (Rc t)</code>.</p>
<h3 id="reference-polymorphism">Reference Polymorphism</h3>
<p>If the <code>own</code> and <code>shared</code> modifiers are omitted from the reference type, the
reference is considered to be polymorphic over both. Since most code will
not care if a reference is shared or not, this gives us some much needed
polymorphism while reducing notational burden. <code>Vec.get_cloned</code> above
is one example of a function taking references polymorphic in whether they are owned or shared.</p>
<p>Note that a polymorphic reference will have the capabilities of the lowest
common denominator - a <code>shared</code> reference. If an owned value is needed a
type error will be issued signalling the function will need to require an owned
reference instead.</p>
<h3 id="internal-mutability">Internal Mutability</h3>
<p>Since mutating through an immutably borrowed reference <code>&amp;t</code> is otherwise impossible,
Ante provides several types for &ldquo;internal mutability.&rdquo; <code>RefCell t</code> will be
a familiar sight to those used to Rust, but using this type entails runtime
checking to uphold the properties of an owned reference (either a mutable reference
can be made or multiple immutable references, but never both at once).</p>
<p>Since Ante natively supports shared references, it is also possibly to obtain a
shared reference directly through a shared pointer type like an <code>Rc t</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">as_mut</span> <span class="p">(</span><span class="n">rc</span><span class="o">:</span> <span class="o">&amp;</span><span class="k">own</span> <span class="k">mut</span> <span class="kt">Rc</span> <span class="n">t</span><span class="p">)</span> <span class="o">:</span> <span class="o">&amp;</span><span class="k">shared</span> <span class="k">mut</span> <span class="n">t</span> <span class="ow">=</span> <span class="o">...</span>
</code></pre></div><p>Note that like most pointer types, we still need an owned reference of the
pointer itself to obtain a reference to the inside. This is because otherwise,
the value would be able to drop out from under us if another shared reference
to the pointer swapped out the Rc struct itself for another. As a result, mutating
an <code>Rc t</code> often requires cloning the outer Rc to ensure it isn&rsquo;t dropped while the
inner references are lent out.</p>
<p>If we wanted to create a shared mutable container where each element is also
mutably shared, we could use a <code>Vec (Rc t)</code> with this technique. Note that the
<code>Vec</code> itself doesn&rsquo;t need to be boxed since we can hand out <code>&amp;shared mut</code> references
from owned values already. If want to store the same <code>Vec</code> reference in other data types
then we would need an <code>Rc</code> or other shared wrapper around the <code>Vec</code>.</p>
<p>This is essentially how many higher level languages make shared mutability work: by boxing
each value. When we employ this strategy in Ante however, we don&rsquo;t even need to box every
value. Just boxing container elements and union data is often sufficient.</p>
<p>If an owned reference <code>&amp;own t</code> or <code>&amp;own mut t</code> is ever required however,
a different type such as <code>RefCell t</code> would still need to be used to provide
the runtime tracking required to enforce this constraint.</p>
<hr>
<h1 id="traits">Traits</h1>
<p>While unrestricted generic functions are useful, often we don&rsquo;t want
to abstract over &ldquo;forall t.&rdquo; but rather abstract over all types that
have certain operations available on them - like adding. In ante, this
is done via traits. You can define a trait as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">trait</span> <span class="kt">Stringify</span> <span class="n">t</span> <span class="k">with</span>
    <span class="n">stringify</span><span class="o">:</span> <span class="n">t</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
</code></pre></div><p>Here we say <code>stringify</code> is a function that takes a value of type <code>t</code> and returns a
<code>String</code>. With this, we can write another function that abstracts over all <code>t</code>&rsquo;s that
can be converted to strings:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">stringify_print</span> <span class="p">(</span><span class="n">x</span><span class="o">:</span> <span class="n">t</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">given</span> <span class="kt">Stringify</span> <span class="n">t</span> <span class="ow">=</span>
    <span class="n">print</span> <span class="p">(</span><span class="n">stringify</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div><p>Just like types and algebraic effects, we can leave out all our traits
in the <code>given</code> clauses and they can still be inferred.</p>
<p>Traits can also define relations over multiple types. For example,
we may want to be more general than the <code>Stringify</code> cast above -
that is we may want to have a trait that can cast to any result
type. To do this we can have a trait that constrains two generic types
such that there must be a cast function that can cast from the
first to the second:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">trait</span> <span class="kt">Cast</span> <span class="n">a</span> <span class="n">b</span> <span class="k">with</span>
    <span class="n">cast</span><span class="o">:</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span>

<span class="c1">// We can cast to a String using</span>
<span class="nf">cast</span> <span class="mi">3</span> <span class="o">:</span> <span class="kt">String</span>
</code></pre></div><h2 id="impls">Impls</h2>
<p>To use functions like <code>stringify</code> or <code>stringify_print</code> above,
we&rsquo;ll have to <code>impl</code>ement the trait for the types we want
to use it with. This can be done with <code>impl</code> blocks:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">stringify_bool</span> <span class="ow">=</span> <span class="k">impl</span> <span class="kt">Stringify</span> <span class="kt">Bool</span> <span class="n">via</span>
    <span class="n">stringify</span> <span class="n">b</span> <span class="ow">=</span>
        <span class="k">if</span> <span class="n">b</span> <span class="k">then</span> <span class="s">&#34;true&#34;</span>
        <span class="k">else</span> <span class="s">&#34;false&#34;</span>
</code></pre></div><p>Then, when we call a function like <code>print_to_string</code> which
requires <code>Stringify t</code> we can pass in a <code>Bool</code> and the
compiler will automatically find the <code>stringify_bool</code> impl
in scope and use that:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">print_to_string</span> <span class="kc">true</span>  <span class="c1">//=&gt; outputs true</span>
</code></pre></div><h2 id="named-impls">Named Impls</h2>
<p>In contrast to other languages with traits or typeclasses, all impls
are named in ante. This enables impls to be imported or hidden from
scope in the same manner as any other construct: by name.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">import</span> <span class="kt">Foo</span><span class="o">.</span><span class="n">hash_bar</span><span class="p">,</span> <span class="n">std_impls</span> <span class="n">hiding</span> <span class="n">eq_foo</span>
</code></pre></div><p>This also enables the ability to specify which impl to use via the <code>via</code>
keyword if there are ever multiple conflicting impls in scope.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">empty</span> <span class="ow">=</span> <span class="k">impl</span> <span class="kt">Stringify</span> <span class="n">a</span> <span class="n">via</span> <span class="n">stringify</span> <span class="n">_</span> <span class="ow">=</span> <span class="s">&#34;&#34;</span>

<span class="nf">print_to_string</span> <span class="kc">true</span> <span class="n">via</span> <span class="n">stringify_bool</span>
</code></pre></div><p>Having multiple conflicting impls anywhere in a codebase is often an error
in other languages, necessitating extensive use of the newtype pattern
for otherwise unnecessary wrapper types and boilerplate. Ante does not
enforce global <a href="#coherence">coherence</a>, instead opting for this name-based
approach to disambiguate where necessary.</p>
<p>As a final example, note that names don&rsquo;t have to be given to individual impls,
we can also group impls together to reduce the notational burden of needing to
name each individual impl. Note that becaues impls are disambiguated by name,
we should avoid including multiple impls for the same trait in the same named group
so that we can disambiguate between them if needed.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">type</span> <span class="kt">Foo</span> <span class="ow">=</span> <span class="n">first</span><span class="o">:</span> <span class="kt">Bar</span><span class="p">,</span> <span class="n">second</span><span class="o">:</span> <span class="kt">Baz</span>

<span class="nf">foo_impls</span> <span class="ow">=</span> <span class="k">impl</span>
    <span class="c1">// We can impl multiple traits via the same method:</span>
    <span class="p">(</span><span class="kt">Hash</span><span class="p">,</span> <span class="kt">Eq</span><span class="p">,</span> <span class="kt">Cmp</span><span class="p">)</span> <span class="kt">Foo</span> <span class="n">via</span> <span class="n">derive</span>

    <span class="c1">// We can also forward to a subset of fields:</span>
    <span class="kt">Print</span> <span class="kt">Foo</span> <span class="n">via</span> <span class="n">forward</span> <span class="n">second</span>

    <span class="c1">// And we can use manual impls</span>
    <span class="kt">Combine</span> <span class="kt">Foo</span> <span class="n">via</span>
        <span class="p">(</span><span class="o">++</span><span class="p">)</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="kt">Foo</span> <span class="n">a</span><span class="o">.</span><span class="n">first</span> <span class="p">(</span><span class="n">qux</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span>
</code></pre></div><p>Note that the mechanism to specify how to derive impls for custom traits is still experimental.
See more on <a href="/docs/ideas#derive-without-macros">the ideas page</a>.</p>
<h2 id="functional-dependencies">Functional Dependencies</h2>
<p>Some languages have a concept called <a href="https://doc.rust-lang.org/1.16.0/book/associated-types.html">associated types</a>.
These are often necessary to define some traits properly which
have multiple type parameters but in which we want the type
of some parameters to depend on others. Ante offers a limited
form of functional dependencies for this which is equivalent to
the associated types approach but with a nicer notation.</p>
<p>To illustrate the need for such a construct, lets say we wanted
to abstract over a vector&rsquo;s <code>get</code> function:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">get</span> <span class="p">(</span><span class="n">vector</span><span class="o">:</span> <span class="kt">Vec</span> <span class="n">t</span><span class="p">)</span> <span class="p">(</span><span class="n">index</span><span class="o">:</span> <span class="kt">Usz</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Maybe</span> <span class="n">t</span> <span class="ow">=</span> <span class="o">...</span>
</code></pre></div><p>We want to be able to use this with any container type, but how?
We can start out with a trait similar to our <code>Cast</code> trait from
before:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">trait</span> <span class="kt">Container</span> <span class="n">c</span> <span class="n">elem</span> <span class="k">with</span>
    <span class="n">get</span><span class="o">:</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="kt">Usz</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="n">elem</span>
</code></pre></div><p>At first glance this looks fine, but there&rsquo;s a problem: we
can implement it with any combination of <code>c</code> and <code>elem</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">conflicting_impls</span> <span class="ow">=</span> <span class="k">impl</span>
    <span class="kt">Container</span> <span class="p">(</span><span class="kt">Vec</span> <span class="kt">I32</span><span class="p">)</span> <span class="kt">I32</span> <span class="n">via</span>
        <span class="n">get</span> <span class="p">(</span><span class="n">v</span><span class="o">:</span> <span class="kt">Vec</span> <span class="kt">I32</span><span class="p">)</span> <span class="p">(</span><span class="n">index</span><span class="o">:</span> <span class="kt">Usz</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Maybe</span> <span class="kt">I32</span> <span class="ow">=</span> <span class="o">...</span>

    <span class="kt">Container</span> <span class="p">(</span><span class="kt">Vec</span> <span class="kt">I32</span><span class="p">)</span> <span class="kt">String</span> <span class="n">via</span>
        <span class="n">get</span> <span class="p">(</span><span class="n">v</span><span class="o">:</span> <span class="kt">Vec</span> <span class="kt">I32</span><span class="p">)</span> <span class="p">(</span><span class="n">index</span><span class="o">:</span> <span class="kt">Usz</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Maybe</span> <span class="kt">String</span> <span class="ow">=</span> <span class="o">...</span>
</code></pre></div><p>But we already had an impl for <code>Vec I32</code>, and defining a
way to get another element type from it makes no sense!
This is what associated types or ante&rsquo;s restricted functional
dependencies solve. We can modify our Container trait to
specify that for any given type <code>c</code>, there&rsquo;s only 1 valid
<code>elem</code> value. We can do that by adding an <code>-&gt;</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">trait</span> <span class="kt">Container</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="n">elem</span> <span class="k">with</span>
    <span class="n">get</span><span class="o">:</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="kt">Usz</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="n">elem</span>

<span class="nf">vec_container</span> <span class="ow">=</span> <span class="k">impl</span> <span class="kt">Container</span> <span class="p">(</span><span class="kt">Vec</span> <span class="n">a</span><span class="p">)</span> <span class="n">a</span> <span class="n">via</span>
    <span class="n">get</span> <span class="p">(</span><span class="n">v</span><span class="o">:</span> <span class="kt">Vec</span> <span class="n">a</span><span class="p">)</span> <span class="p">(</span><span class="n">i</span><span class="o">:</span> <span class="kt">Usz</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Maybe</span> <span class="n">a</span> <span class="ow">=</span> <span class="o">...</span>
</code></pre></div><p>This information is used during type inference
so if we have e.g. <code>e = get (b: ByteString) 0</code> and there
is an impl for <code>Container ByteString U8</code> in scope then we also
know that <code>e : U8</code>.</p>
<p>Note that using a functional dependency in a trait signature
looks a lot like separating the return type from the arguments
of a function. This was intentional; a good
rule of thumb on when to use functional dependencies is if
the type in question only appears as a return type for the
function defined by the trait. For the <code>Container</code> example
above, <code>elem</code> is indeed only used in the return type of <code>get</code>.
The most notable exception to this rule is the <code>Cast</code> trait
defined earlier in which it is useful to have two impls
<code>Cast I32 String</code> and <code>Cast I32 F64</code> to cast integers
to strings and to floats respectively.</p>
<h2 id="coherence">Coherence</h2>
<p>Ante has no concept of global coherence for impls,
so it is perfectly valid to define overlapping impls or define
impls for types outside of the modules the type or trait were
declared in. If there are ever conflicts with multiple valid
impls being found, an error is given at the callsite and the
user will have to manually specify which to use either by only
importing one of these impls or with an explicit <code>via</code> clause
at the callsite:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">add</span> <span class="ow">=</span> <span class="k">impl</span> <span class="kt">Combine</span> <span class="kt">I32</span> <span class="n">via</span> <span class="p">(</span><span class="o">++</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="o">+</span><span class="p">)</span>
<span class="nf">mul</span> <span class="ow">=</span> <span class="k">impl</span> <span class="kt">Combine</span> <span class="kt">I32</span> <span class="n">via</span> <span class="p">(</span><span class="o">++</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="o">*</span><span class="p">)</span>

<span class="nf">print</span> <span class="p">(</span><span class="mi">2</span> <span class="o">++</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1">// Error, multiple matching impls found! `add` and `mul` are both in scope</span>

<span class="nf">print</span> <span class="p">(</span><span class="mi">2</span> <span class="o">++</span> <span class="mi">3</span><span class="p">)</span> <span class="n">via</span> <span class="n">add</span>  <span class="c1">//=&gt; 5</span>
<span class="nf">print</span> <span class="p">(</span><span class="mi">2</span> <span class="o">++</span> <span class="mi">3</span><span class="p">)</span> <span class="n">via</span> <span class="n">mul</span>  <span class="c1">//=&gt; 6</span>
</code></pre></div><hr>
<h1 id="modules">Modules</h1>
<p>Ante&rsquo;s module system follows a simple, hierarchical structure
based on the file system. Given the following file system:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">.
├── foo.an
├── bar.an
├─┬ baz
│ ╰── nested.an
╰─┬ qux
  ├── nested.an
  ╰── qux.an
</code></pre></div><p>We get the corresponding module hierarchy:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="kt">Foo</span>
<span class="kt">Bar</span>
<span class="kt">Baz</span><span class="o">.</span><span class="kt">Nested</span>
<span class="kt">Qux</span>
<span class="kt">Qux</span><span class="o">.</span><span class="kt">Nested</span>
</code></pre></div><p>Note how <code>qux/qux.an</code> is considered a top-level module
because it matched the name of the folder it was in and
how <code>baz/nested.an</code> is under <code>Baz</code>&rsquo;s namespace because it was
in the <code>baz</code> folder. The two <code>nested.an</code> files are also in
separate parent modules so there is no name conflict.</p>
<h2 id="imports">Imports</h2>
<p>Importing symbols within a module into scope can be
done with an <code>import</code> expression. Lets say
we were using the module hierarchy given in the
<a href="#modules">section above</a>. In our <code>Baz.Nested</code> file we
have:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">nested_baz</span> <span class="ow">=</span> <span class="mi">0</span>

<span class="nf">print_baz</span> <span class="p">()</span> <span class="ow">=</span>
    <span class="n">print</span> <span class="s">&#34;baz&#34;</span>

<span class="nf">get_baz</span> <span class="p">()</span> <span class="ow">=</span> <span class="s">&#34;baz&#34;</span>
</code></pre></div><p>To use these definitions from <code>Foo</code> we can import them:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">import</span> <span class="kt">Baz</span><span class="o">.</span><span class="kt">Nested</span><span class="o">.*</span>

<span class="nf">baz</span> <span class="ow">=</span> <span class="n">get_baz</span> <span class="p">()</span>
<span class="nf">print</span> <span class="s">&#34;baz: $baz, nested_baz = $nested_baz&#34;</span>
</code></pre></div><p>We can also import only some symbols into scope:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// This syntax was chosen so that when adding new imports</span>
<span class="c1">// you only need to edit the end of the line rather than</span>
<span class="c1">// needing to add a &#39;{&#39; or similar token before print_baz as well.</span>
<span class="k">import</span> <span class="kt">Baz</span><span class="o">.</span><span class="kt">Nested</span><span class="o">.</span><span class="n">print_baz</span><span class="p">,</span> <span class="n">get_baz</span>

<span class="nf">print</span> <span class="p">(</span><span class="n">get_baz</span> <span class="p">())</span>
<span class="nf">print_baz</span> <span class="p">()</span>
</code></pre></div><p>Now, lets say we are in module Bar and want to import <code>Baz.Nested</code>
but we already have a function named <code>get_baz</code> in scope. We cannot
do <code>import Baz.Nested.*</code> since there would be conflicting names in scope.
We could import only the functions we need but if we require many functions
from <code>Baz.Nested</code> then this may take some time. For this reason, when using
wildcard imports, you can also specify definitions to exclude, via the <code>hiding</code> clause:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">import</span> <span class="kt">Baz</span><span class="o">.</span><span class="kt">Nested</span><span class="o">.*</span> <span class="n">hiding</span> <span class="n">get_baz</span>

<span class="c1">// No error here</span>
<span class="nf">get_baz</span> <span class="p">()</span> <span class="ow">=</span> <span class="n">my_local_baz</span>
</code></pre></div><p>Alternatively, you can also rename imports via <code>as</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">import</span> <span class="kt">Baz</span><span class="o">.</span><span class="kt">Nested</span><span class="o">.*</span> <span class="n">hiding</span> <span class="n">get_baz</span>

<span class="c1">// If we want to import everything from Baz.Nested while renaming</span>
<span class="c1">// some of the items we need to list them separately since `as`</span>
<span class="c1">// doesn&#39;t work with * imports:</span>
<span class="k">import</span> <span class="kt">Baz</span><span class="o">.</span><span class="kt">Nested</span><span class="o">.</span><span class="n">get_baz</span> <span class="n">as</span> <span class="n">other_get_baz</span>

<span class="k">import</span> <span class="kt">Foo</span><span class="o">.</span><span class="n">a</span> <span class="n">as</span> <span class="n">foo_a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="n">as</span> <span class="n">foo_d</span>

<span class="c1">// No error here</span>
<span class="nf">get_baz</span> <span class="p">()</span> <span class="ow">=</span> <span class="n">my_local_baz</span>
</code></pre></div><h2 id="exports-and-visibility">Exports and Visibility</h2>
<p>All names defined at global scope are by default visible to the entire
package but not to any external packages. Items can optionally be exported
across package boundaries by adding each name to an <code>export</code> list at the top
of the module.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// fib and sum will be exported as library functions</span>
<span class="nf">export</span> <span class="n">fib</span><span class="p">,</span> <span class="n">sum</span>

<span class="nf">fib</span> <span class="n">n</span> <span class="ow">=</span> <span class="n">fib_helper</span> <span class="n">n</span> <span class="mi">0</span> <span class="mi">1</span>

<span class="nf">fib_helper</span> <span class="n">n</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">then</span> <span class="n">a</span>
    <span class="k">else</span> <span class="n">fib_helper</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">b</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>

<span class="nf">sum</span> <span class="n">n</span> <span class="ow">=</span> <span class="n">sum_helper</span> <span class="n">n</span> <span class="mi">0</span>

<span class="nf">sum_helper</span> <span class="n">n</span> <span class="n">acc</span> <span class="ow">=</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">then</span> <span class="n">acc</span>
    <span class="k">else</span> <span class="n">sum_helper</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">acc</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span>
</code></pre></div><hr>
<h1 id="packages">Packages</h1>
<p>In addition to modules, Ante has another unit of organization called packages.
Each package is meant to correspond to a project where each dependency is
also a package.</p>
<p>At the source code level, import paths are prefixed by a package name.
For example, in <code>import Foo.Bar.Baz</code>, <code>Foo</code> is the package to search for <code>Bar.Baz</code>
within. For new programs in an otherwise empty directory, the only packages
visible will be the current package, using the current directory&rsquo;s name,
and the <code>Std</code> package containing the standard library.</p>
<p>Packages are not required to all be in the same directory as the current project.
Instead, the compiler searches for packages in a few directories by default:</p>
<ul>
<li><code>.</code> for the current package</li>
<li><code>/path/to/stdlib</code> for the stdlib</li>
<li><code>./deps</code> for dependencies of the current package</li>
</ul>
<p>These directories to search for packages in are called the &ldquo;relative roots&rdquo; and can
be configured via compiler flags. The advantages of this design are as follows:</p>
<ul>
<li>An internet connection is never required to build a project</li>
<li>This design is flexible and compatible with a package manager, although it does not require one</li>
<li>Git repositories or other local projects can be cloned into the <code>deps</code> directory to quickly add local dependencies</li>
<li>Dependencies aren&rsquo;t required to be registered with a package repository just to be used at the language level</li>
<li>A package manager is free to configure the relative roots itself so that users never need to touch
the <code>deps</code> directory or relative roots if they use a package manager</li>
<li>Versioning is left to the package manager</li>
<li>Multiple projects sharing the same dependencies can be accomplished by simple symlinks</li>
<li>Diamond dependencies are naturally allowed</li>
</ul>
<h2 id="diamond-dependencies">Diamond Dependencies</h2>
<p>Diamond dependencies occur when two dependencies of a project both depend on the same
dependency, e.g. package <code>A</code> has dependencies <code>B</code> and <code>C</code> which both depend on <code>D</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  B
 / \
A   D
 \ /
  C
</code></pre></div><p>This is a valid configuration, and whether or not the <code>D</code> that is shared by <code>B</code> and <code>C</code>
is the same <code>D</code> is determined by the absolute file path to <code>D</code>. If the file path is the
same, the package is the same and its types are thus interchangeable. This can be done
automatically - for example by a package manager recognizing both <code>B</code> and <code>C</code> require <code>D</code>
and providing the same <code>D</code> to both by configuring the compiler&rsquo;s relative roots or using symlinks.</p>
<p>Similarly, if <code>B</code> and <code>C</code> require different versions of <code>D</code>, these will naturally be
located at separate filepaths and treated as different packages. So <code>B</code> would require <code>D1</code>
and <code>C</code> would require <code>D2</code>. The result would be the following valid package graph, and
types from <code>D1</code> would be incompatible with types from <code>D2</code> (and vice-versa).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  B - D1
 /
A
 \
  C - D2
</code></pre></div><hr>
<h1 id="extern">Extern</h1>
<p>Ante&rsquo;s C FFI is currently limited to <code>extern</code> functions.
Without <code>extern</code>, all definitions must be initialized
with a value and any names used may be mangled in the
compiled output.</p>
<p>You can use extern by declaring a value and giving it
a type. Make sure the type is accurate as the compiler
cannot check these signatures for correctness:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">extern</span> <span class="n">puts</span><span class="o">:</span> <span class="kt">C</span><span class="o">.</span><span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">C</span><span class="o">.</span><span class="kt">Int</span>
</code></pre></div><p>You can also use extern with a block of declarations:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">extern</span>
    <span class="n">exit</span><span class="o">:</span> <span class="kt">C</span><span class="o">.</span><span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="n">never_returns</span>
    <span class="n">malloc</span><span class="o">:</span> <span class="kt">Usz</span> <span class="ow">-&gt;</span> <span class="kt">Ptr</span> <span class="n">a</span>
    <span class="n">printf</span><span class="o">:</span> <span class="kt">C</span><span class="o">.</span><span class="kt">String</span> <span class="ow">-&gt;</span> <span class="o">...</span> <span class="ow">-&gt;</span> <span class="kt">C</span><span class="o">.</span><span class="kt">Int</span>
</code></pre></div><p>Note that you can also use varargs (<code>...</code>) in these declarations
and it will work as expected. There is currently no equivalent
to an untagged C union in ante so using any FFI that requires
passing in unions will require putting them behind pointers
in ante.</p>
<hr>
<h1 id="algebraic-effects">Algebraic Effects</h1>
<p>Algebraic effects are a more complex topic described more in detail by
research languages like <a href="https://www.eff-lang.org/">Eff</a> and <a href="https://koka-lang.github.io/koka/doc/index.html">Koka</a>.</p>
<p>In short, algebraic effects are similar to a resumable exception, and they
allow for non-local control flow that makes some programming styles more natural.
Algebraic effects also serve as an alternative to monads for purely functional
programming. Compared to monads, algebraic effects compose naturally but are
slightly more restrictive.</p>
<p>Algebraic effects can be used first by declaring the effect with the <code>effect</code> keyword,
then by performing the effect within a function. Once this happens,
the computation will suspend, and the program will call the most recent
statically-known effect handler.
From there, the effect handler can stop the computation and return a value as
with exceptions, or it can resume the computation and continue by calling <code>resume</code>
with the value to resume with. The type of value needed to resume depends on
the return type of the effect. For example, if our effect is:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-an" data-lang="an"><span class="k">effect</span> <span class="kt">GiveInt</span> <span class="k">with</span>
    <span class="n">give_int</span><span class="o">:</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">I32</span>
</code></pre></div><p>Then we will have to call <code>resume</code> with an <code>I32</code> to continue the original computation.</p>
<p>In an effect handler, we can match on any effects performed within the matched
expression. For example, if we want to write a handler for the <code>GiveInt</code> effect above,
we may write a function like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-an" data-lang="an"><span class="nf">handle_give_int</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">GiveInt</span><span class="p">)</span> <span class="o">:</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="n">give_int</span> <span class="n">str</span> <span class="ow">-&gt;</span>
        <span class="k">if</span> <span class="n">str</span> <span class="o">==</span> <span class="s">&#34;zero&#34;</span>
        <span class="k">then</span> <span class="k">resume</span> <span class="mi">0</span>
        <span class="k">else</span> <span class="k">resume</span> <span class="mi">123</span>
</code></pre></div><p>Finally, if we have a function <code>do_math</code> which uses the <code>GiveInt</code> effect, here&rsquo;s
how we&rsquo;d pass it to <code>handle_give_int</code> to properly handle the effect:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-an" data-lang="an"><span class="nf">do_math</span> <span class="p">(</span><span class="n">x</span><span class="o">:</span> <span class="kt">I32</span><span class="p">)</span> <span class="o">:</span> <span class="kt">I32</span> <span class="k">can</span> <span class="kt">GiveInt</span> <span class="ow">=</span>
    <span class="n">a</span> <span class="ow">=</span> <span class="n">give_int</span> <span class="s">&#34;zero&#34;</span>
    <span class="n">b</span> <span class="ow">=</span> <span class="n">give_int</span> <span class="s">&#34;foo&#34;</span>
    <span class="n">x</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="nf">handle_give_int</span> <span class="p">(</span><span class="k">fn</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="n">do_math</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1">//=&gt; 126</span>
</code></pre></div><h2 id="sugar-for-applying-handlers">Sugar for applying handlers</h2>
<p>You&rsquo;ll notice <code>handle_give_int</code> expects a function, so we have to wrap <code>do_math 3</code> in a
lambda before we pass it into our handler. Since this operation is so common, ante provides
the <code>with</code> operator which will wrap its left argument in a lambda and pass it to the function
on its right. Here is the definition of <code>with</code> in pseudocode:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">a</span> <span class="k">with</span> <span class="n">b</span>
    <span class="ow">=</span> <span class="n">b</span> <span class="p">(</span><span class="k">fn</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="p">)</span>
</code></pre></div><p>With this we can rewrite the last line as:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">do_math</span> <span class="mi">3</span> <span class="k">with</span> <span class="n">handle_give_int</span>
</code></pre></div><p>There are also times when we want to use a handler to handle an entire block. For this,
we can use the <code>using</code> keyword:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="c1">// try: (Unit -&gt; a can Fail) -&gt; Maybe a</span>
<span class="nf">using</span> <span class="n">try</span>

<span class="nf">foo</span> <span class="ow">=</span> <span class="n">failable_operation</span> <span class="p">()</span>
<span class="nf">bar</span> <span class="ow">=</span> <span class="n">failable_operation</span> <span class="p">()</span>
<span class="nf">foo</span> <span class="o">+</span> <span class="n">bar</span> <span class="o">*</span> <span class="mi">2</span>
</code></pre></div><p>Which desugars to:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">try</span> <span class="k">fn</span> <span class="p">()</span> <span class="ow">-&gt;</span>
    <span class="n">foo</span> <span class="ow">=</span> <span class="n">failable_operation</span> <span class="p">()</span>
    <span class="n">bar</span> <span class="ow">=</span> <span class="n">failable_operation</span> <span class="p">()</span>
    <span class="n">foo</span> <span class="o">+</span> <span class="n">bar</span> <span class="o">*</span> <span class="mi">2</span>
</code></pre></div><p>This is often useful for error handling or early returns across function boundaries.</p>
<h2 id="more-on-handlers">More on Handlers</h2>
<h3 id="multiple-handlers">Multiple Handlers</h3>
<p>Unlike traits where impl search is automatic, effect handlers are
manually inserted by the programmer. This allows for multiple handlers
to be defined for any effect. As an example, lets define another handler
for <code>GiveInt</code> in addition to <code>handle_give_int</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-an" data-lang="an"><span class="nf">the_int</span> <span class="p">(</span><span class="n">int</span><span class="o">:</span> <span class="kt">I32</span><span class="p">)</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">GiveInt</span><span class="p">)</span> <span class="o">:</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="n">give_int</span> <span class="n">_</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="n">int</span>

<span class="nf">do_math</span> <span class="mi">1</span> <span class="k">with</span> <span class="n">the_int</span> <span class="mi">5</span>  <span class="c1">//=&gt; 11</span>
</code></pre></div><h3 id="matching-on-the-returned-value">Matching on the Returned Value</h3>
<p>Handle expressions can also match on the return value
of the handled expression</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-an" data-lang="an"><span class="nf">count_giveint_calls</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">GiveInt</span><span class="p">)</span> <span class="o">:</span> <span class="kt">I32</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="k">return</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="mi">0</span>
    <span class="o">|</span> <span class="n">give_int</span> <span class="n">_</span> <span class="ow">-&gt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="k">resume</span> <span class="mi">0</span>


<span class="nf">do_math</span> <span class="mi">5</span> <span class="k">with</span> <span class="n">count_giveint_calls</span>  <span class="c1">//=&gt; 2</span>
</code></pre></div><p>This example can be confusing at first - how can we always return
an integer representing the number of GiveInt calls if our function
says it returns some type <code>a</code>? Lets work this out step by step
to see how it expands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">do_math</span> <span class="mi">5</span> <span class="k">with</span> <span class="n">count_giveint_calls</span>

<span class="c1">// First we expand and substitute</span>
<span class="k">handle</span>
    <span class="n">a</span> <span class="ow">=</span> <span class="n">give_int</span> <span class="s">&#34;zero&#34;</span>
    <span class="n">b</span> <span class="ow">=</span> <span class="n">give_int</span> <span class="s">&#34;foo&#34;</span>
    <span class="mi">5</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="o">|</span> <span class="k">return</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="mi">0</span>
<span class="o">|</span> <span class="n">give_int</span> <span class="n">_</span> <span class="ow">-&gt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="k">resume</span> <span class="mi">0</span>

<span class="c1">// Then reduce via our give_int rule - continuing</span>
<span class="c1">// the computation with the value 0 and adding 1 to the result</span>
<span class="k">handle</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span> <span class="ow">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">b</span> <span class="ow">=</span> <span class="n">give_int</span> <span class="s">&#34;foo&#34;</span><span class="p">;</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
<span class="o">|</span> <span class="k">return</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="mi">0</span>
<span class="o">|</span> <span class="n">give_int</span> <span class="n">_</span> <span class="ow">-&gt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="k">resume</span> <span class="mi">0</span>

<span class="c1">// Reduce via give_int again for b</span>
<span class="k">handle</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span> <span class="ow">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">b</span> <span class="ow">=</span> <span class="mi">0</span><span class="p">;</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">))</span>
<span class="o">|</span> <span class="k">return</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="mi">0</span>
<span class="o">|</span> <span class="n">give_int</span> <span class="n">_</span> <span class="ow">-&gt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="k">resume</span> <span class="mi">0</span>

<span class="c1">// Now we finish evaluating the function and would</span>
<span class="c1">// normally get a result of 5</span>
<span class="k">handle</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="k">return</span> <span class="mi">5</span><span class="p">))</span>
<span class="o">|</span> <span class="k">return</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="mi">0</span>
<span class="o">|</span> <span class="n">give_int</span> <span class="n">_</span> <span class="ow">-&gt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="k">resume</span> <span class="mi">0</span>

<span class="c1">// Since our handler matches on this return value,</span>
<span class="c1">// we use that rule next to map it to 0</span>
<span class="k">handle</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">0</span><span class="p">)</span>
<span class="o">|</span> <span class="k">return</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="mi">0</span>
<span class="o">|</span> <span class="n">give_int</span> <span class="n">_</span> <span class="ow">-&gt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="k">resume</span> <span class="mi">0</span>

<span class="c1">// Finally, 1 + 1 + 0 evaluates to 2 with no further effects</span>
<span class="mi">2</span>
</code></pre></div><h3 id="resuming-multiple-times">Resuming Multiple Times</h3>
<p><code>resume</code> is a first-class function like any other, so we
can call it multiple times, or pass it to higher-order functions
like <code>map</code> and <code>flatmap</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-an" data-lang="an"><span class="nf">these_ints</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">GiveInt</span><span class="p">)</span> <span class="p">(</span><span class="n">ints</span><span class="o">:</span> <span class="kt">Vec</span> <span class="kt">I32</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Vec</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="k">return</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="o">|</span> <span class="n">give_int</span> <span class="n">_</span> <span class="ow">-&gt;</span> <span class="n">flatmap</span> <span class="n">ints</span> <span class="k">resume</span>


<span class="nf">do_math</span> <span class="mi">2</span>
    <span class="k">with</span> <span class="n">these_ints</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>  <span class="c1">//=&gt; [4, 6, 6, 8]</span>
</code></pre></div><p>This handler is similar to the list monad in that it will keep
resuming from the given function with all combinations of the given
values, returning a Vec of all the return values when finished.</p>
<h3 id="resuming-zero-times">Resuming Zero Times</h3>
<p>Handlers may also choose not to resume at all, simply by
not calling <code>resume</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-an" data-lang="an"><span class="nf">interpret</span> <span class="p">(</span><span class="n">default_value</span><span class="o">:</span> <span class="n">a</span><span class="p">)</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">GiveInt</span><span class="p">)</span> <span class="o">:</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="k">import</span> <span class="kt">Random</span><span class="o">.</span><span class="n">random</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="n">give_int</span> <span class="s">&#34;zero&#34;</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="mi">0</span>
    <span class="o">|</span> <span class="n">give_int</span> <span class="s">&#34;random&#34;</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="o">$</span> <span class="n">random</span> <span class="p">()</span>
    <span class="c1">// Do not resume, return the default value instead</span>
    <span class="o">|</span> <span class="n">give_int</span> <span class="n">_</span> <span class="ow">-&gt;</span> <span class="n">default_value</span>

<span class="nf">do_math</span> <span class="mi">7</span> <span class="k">with</span> <span class="n">interpret</span> <span class="mi">42</span>  <span class="c1">//=&gt; 42</span>
</code></pre></div><h2 id="error-handling">Error Handling</h2>
<p>Ante primarily uses the <code>Fail</code> and <code>Throw e</code> effects for error handling.
These roughly correspond to <code>Maybe t</code> and <code>Result t e</code> respectively.
Being effects however, these are automatically propagated up the callstack:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">add_even_numbers</span> <span class="p">(</span><span class="n">a</span><span class="o">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">(</span><span class="n">b</span><span class="o">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">:</span> <span class="kt">U64</span> <span class="k">can</span> <span class="kt">Fail</span> <span class="ow">=</span>
    <span class="n">n1</span> <span class="ow">=</span> <span class="n">parse</span> <span class="n">a</span>
    <span class="n">n2</span> <span class="ow">=</span> <span class="n">parse</span> <span class="n">b</span> <span class="c1">// parse: String -&gt; U64 can Fail</span>

    <span class="k">if</span> <span class="n">n1</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">and</span> <span class="n">n2</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">then</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span>
    <span class="k">else</span> <span class="n">fail</span> <span class="p">()</span>
</code></pre></div><p>Handling these effects can be done via manual <code>handle</code> expressions, or
via the <code>try</code> and <code>catch</code> helper functions
which convert Fails to Maybe, and Throws to Results:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">try</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">Fail</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Maybe</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="k">return</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="kt">Some</span> <span class="n">x</span>
    <span class="o">|</span> <span class="n">fail</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="kt">None</span>

<span class="nf">catch</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">Throw</span> <span class="n">e</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Result</span> <span class="n">a</span> <span class="n">e</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="k">return</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="kt">Ok</span> <span class="n">x</span>
    <span class="o">|</span> <span class="n">throw</span> <span class="n">e</span> <span class="ow">-&gt;</span> <span class="kt">Error</span> <span class="n">e</span>

<span class="nf">print</span> <span class="p">(</span><span class="n">add_even_numbers</span> <span class="s">&#34;2&#34;</span> <span class="s">&#34;4&#34;</span> <span class="k">with</span> <span class="n">try</span><span class="p">)</span> <span class="c1">//=&gt; Some 6</span>
<span class="nf">print</span> <span class="p">(</span><span class="n">add_even_numbers</span> <span class="s">&#34;2&#34;</span> <span class="s">&#34;5&#34;</span> <span class="k">with</span> <span class="n">try</span><span class="p">)</span> <span class="c1">//=&gt; None</span>
</code></pre></div><p>Because effects can be naturally composed, functions returning multiple
different errors can also be naturally composed without requiring users
to define their own error unions:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">foo</span> <span class="p">()</span> <span class="k">can</span> <span class="kt">Throw</span> <span class="kt">FileError</span><span class="p">,</span> <span class="kt">Throw</span> <span class="kt">ParseError</span><span class="p">,</span> <span class="kt">Throw</span> <span class="kt">BarError</span> <span class="ow">=</span>
    <span class="n">f</span> <span class="ow">=</span> <span class="kt">File</span><span class="o">.</span><span class="n">open</span> <span class="s">&#34;foo.txt&#34;</span>
    <span class="n">contents</span> <span class="ow">=</span> <span class="n">parse</span> <span class="p">(</span><span class="n">read</span> <span class="n">f</span><span class="p">)</span>
    <span class="n">bar</span> <span class="n">contents</span>
</code></pre></div><h2 id="useful-effects">Useful Effects</h2>
<p>Effects are a very broadly useful feature, yet the previous examples
have been rather abstract. Here are some practical usecases for effects.</p>
<h3 id="state">State</h3>
<p>Algebraic Effects can be used to emulate mutable state - automatically
threading stateful values through multiple functions.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">effect</span> <span class="kt">Use</span> <span class="n">a</span> <span class="k">with</span>
    <span class="n">get</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span>
    <span class="n">put</span><span class="o">:</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Unit</span>

<span class="nf">state</span> <span class="p">(</span><span class="n">current_state</span><span class="o">:</span> <span class="n">s</span><span class="p">)</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">Use</span> <span class="n">s</span><span class="p">)</span> <span class="o">:</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="n">put</span> <span class="n">new_state</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="p">()</span> <span class="k">with</span> <span class="n">state</span> <span class="n">new_state</span>
    <span class="o">|</span> <span class="n">get</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="n">current_state</span> <span class="k">with</span> <span class="n">state</span> <span class="n">current_state</span>


<span class="k">type</span> <span class="kt">Expr</span> <span class="ow">=</span>
   <span class="o">|</span> <span class="kt">Int</span> <span class="kt">I32</span>
   <span class="o">|</span> <span class="kt">Var</span> <span class="kt">String</span>
   <span class="o">|</span> <span class="kt">Add</span> <span class="kt">Expr</span> <span class="kt">Expr</span>
   <span class="o">|</span> <span class="kt">Let</span> <span class="kt">String</span> <span class="p">(</span><span class="n">rhs</span><span class="o">:</span> <span class="kt">Expr</span><span class="p">)</span> <span class="p">(</span><span class="n">body</span><span class="o">:</span> <span class="kt">Expr</span><span class="p">)</span>

<span class="kt">Eval</span> <span class="ow">=</span> <span class="kt">Use</span> <span class="p">(</span><span class="kt">Map</span> <span class="kt">String</span> <span class="kt">I32</span><span class="p">)</span>

<span class="nf">lookup</span> <span class="p">(</span><span class="n">name</span><span class="o">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Maybe</span> <span class="kt">I32</span> <span class="k">can</span> <span class="kt">Eval</span> <span class="ow">=</span>
    <span class="n">map</span> <span class="ow">=</span> <span class="n">get</span> <span class="p">()</span>
    <span class="n">map</span><span class="o">.</span><span class="n">get</span> <span class="n">name</span>

<span class="nf">define</span> <span class="p">(</span><span class="n">name</span><span class="o">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">(</span><span class="n">value</span><span class="o">:</span> <span class="kt">I32</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">Eval</span> <span class="ow">=</span>
    <span class="n">map</span> <span class="ow">=</span> <span class="n">get</span> <span class="p">()</span>
    <span class="n">put</span> <span class="p">(</span><span class="n">map</span><span class="o">.</span><span class="n">insert</span> <span class="n">name</span> <span class="n">value</span><span class="p">)</span>

<span class="nf">eval</span> <span class="p">(</span><span class="n">expr</span><span class="o">:</span> <span class="kt">Expr</span><span class="p">)</span> <span class="o">:</span> <span class="kt">I32</span> <span class="k">can</span> <span class="kt">Eval</span> <span class="ow">=</span>
    <span class="k">match</span> <span class="n">expr</span>
    <span class="o">|</span> <span class="kt">Int</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">x</span>
    <span class="o">|</span> <span class="kt">Var</span> <span class="n">s</span> <span class="ow">-&gt;</span> <span class="n">lookup</span> <span class="n">s</span> <span class="o">.</span><span class="n">or_error</span> <span class="s">&#34;$s not defined&#34;</span>
    <span class="o">|</span> <span class="kt">Add</span> <span class="n">lhs</span> <span class="n">rhs</span> <span class="ow">-&gt;</span> <span class="n">eval</span> <span class="n">lhs</span> <span class="o">+</span> <span class="n">eval</span> <span class="n">rhs</span>
    <span class="o">|</span> <span class="kt">Let</span> <span class="n">name</span> <span class="n">rhs</span> <span class="n">body</span> <span class="ow">-&gt;</span>
        <span class="n">define</span> <span class="n">name</span> <span class="p">(</span><span class="n">eval</span> <span class="n">rhs</span><span class="p">)</span>
        <span class="n">eval</span> <span class="n">body</span>

<span class="nf">main</span> <span class="p">()</span> <span class="ow">=</span>
    <span class="n">e</span> <span class="ow">=</span> <span class="kt">Let</span> <span class="s">&#34;foo&#34;</span> <span class="p">(</span><span class="kt">Int</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="kt">Add</span> <span class="p">(</span><span class="kt">Var</span> <span class="s">&#34;foo&#34;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Int</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">eval</span> <span class="n">e</span> <span class="k">with</span> <span class="n">state</span> <span class="kt">Map</span><span class="o">.</span><span class="n">empty</span>  <span class="c1">//=&gt; 3</span>
</code></pre></div><p>Note that compared to the monadic approach, we do not
need to explicitly bind between effectful operations,
so we are free to write an expression like <code>define name (eval rhs)</code>
or <code>eval lhs + eval rhs</code> without needing to bind intermediate values to a name
or use a combinator function like <code>liftM2</code>.</p>
<p>The imperative programmer may also note that nowhere do we have to
explicitly thread through our map of names to values. This same
technique can be used to obviate the need to explicitly pass around
context parameters to functions in larger codebases. Moreover, since
whether a function requires such a context or not can be inferred,
removing a context from a function no longer requires manually removing
function arguments from every call site of that function. We gain all
this while still keeping the use of a context explicit in the function&rsquo;s
signature. We know any function marked <code>can Eval</code> will
make use of this context and potentially modify it. If we wanted to
separate these two notions, we could split <code>Get</code> and <code>Put</code> into different
effects instead of including them both in a <code>Use</code> effect</p>
<p>This example also highlights we can use type aliases for effect types.</p>
<h3 id="imperative-programming">Imperative Programming</h3>
<p>Combining <code>State</code>, IO effects, and a <code>Loop</code> effect for loops that can <code>Break</code>
or <code>Continue</code> lets us program in a very imperative style,
while remaining purely functional behind the scenes.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-an" data-lang="an"><span class="k">effect</span> <span class="kt">Loop</span> <span class="k">with</span>
    <span class="n">break</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span>
    <span class="k">continue</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span>

<span class="nf">for</span> <span class="p">(</span><span class="n">iter</span><span class="o">:</span> <span class="n">i</span><span class="p">)</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="n">e</span> <span class="ow">-&gt;</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">Loop</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">Iterate</span> <span class="n">i</span> <span class="n">e</span> <span class="ow">=</span>
    <span class="k">match</span> <span class="n">next</span> <span class="n">iter</span>
    <span class="o">|</span> <span class="kt">None</span> <span class="ow">-&gt;</span> <span class="p">()</span>
    <span class="o">|</span> <span class="kt">Some</span> <span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span> <span class="ow">-&gt;</span>
        <span class="k">handle</span> <span class="n">f</span> <span class="n">elem</span>
        <span class="o">|</span> <span class="n">break</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="p">()</span>
        <span class="o">|</span> <span class="k">continue</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="n">for</span> <span class="n">rest</span> <span class="n">f</span>
        <span class="c1">// If the body returns normally, we also want to continue the loop</span>
        <span class="o">|</span> <span class="k">return</span> <span class="n">_</span> <span class="ow">-&gt;</span> <span class="n">for</span> <span class="n">rest</span> <span class="n">f</span>

<span class="nf">while</span> <span class="p">(</span><span class="n">cond</span><span class="o">:</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">(</span><span class="n">body</span><span class="o">:</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Unit</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">State</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="k">if</span> <span class="n">cond</span> <span class="p">(</span><span class="n">get</span> <span class="p">())</span> <span class="k">then</span>
        <span class="n">body</span> <span class="p">(</span><span class="n">get</span> <span class="p">())</span>
        <span class="n">while</span> <span class="n">cond</span> <span class="n">body</span>

<span class="nf">do_while</span> <span class="p">(</span><span class="n">body</span><span class="o">:</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">State</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="k">if</span> <span class="n">body</span> <span class="p">(</span><span class="n">get</span> <span class="p">())</span> <span class="k">then</span> <span class="n">do_while</span> <span class="n">body</span>

<span class="c1">// Loop until we eventually find a prime number through sheer luck</span>
<span class="nf">loop_examples</span> <span class="p">(</span><span class="n">vec</span><span class="o">:</span> <span class="kt">Vec</span> <span class="kt">I32</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">Print</span><span class="p">,</span> <span class="kt">State</span> <span class="kt">I32</span> <span class="ow">=</span>
    <span class="n">for</span> <span class="n">vec</span> <span class="k">fn</span> <span class="n">elem</span> <span class="ow">-&gt;</span>
        <span class="n">largest</span> <span class="ow">=</span> <span class="n">get</span> <span class="p">()</span>
        <span class="k">if</span> <span class="n">largest</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="k">then</span>
            <span class="n">print</span> <span class="s">&#34;oops, too big!&#34;</span>
            <span class="n">break</span> <span class="p">()</span>
        <span class="k">else</span> <span class="k">if</span> <span class="n">largest</span> <span class="o">&lt;</span> <span class="n">elem</span> <span class="k">then</span>
            <span class="n">put</span> <span class="n">elem</span>

    <span class="c1">// While our current integer State value is_even, loop</span>
    <span class="n">while</span> <span class="n">is_even</span> <span class="k">fn</span> <span class="n">x</span> <span class="ow">-&gt;</span>
        <span class="n">put</span> <span class="o">$</span> <span class="n">x</span> <span class="o">+</span> <span class="n">random_in</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">do_while</span> <span class="k">fn</span> <span class="n">x</span> <span class="ow">-&gt;</span>
        <span class="n">print</span> <span class="s">&#34;looping...&#34;</span>
        <span class="n">put</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">not</span> <span class="n">is_prime</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

<span class="nf">find_random_prime</span> <span class="p">(</span><span class="n">vec</span><span class="o">:</span> <span class="kt">Vec</span> <span class="kt">I32</span><span class="p">)</span> <span class="o">:</span> <span class="kt">I32</span> <span class="k">can</span> <span class="kt">Print</span> <span class="ow">=</span>
    <span class="n">loop_examples</span> <span class="n">vec</span> <span class="k">with</span> <span class="n">final_state</span> <span class="mi">0</span>
</code></pre></div><h3 id="generators">Generators</h3>
<p>The yield effect provides a way to implement generators.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">effect</span> <span class="kt">Yield</span> <span class="n">a</span> <span class="k">with</span>
    <span class="n">yield</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span>

<span class="nf">traverse</span> <span class="p">(</span><span class="n">xs</span><span class="o">:</span> <span class="kt">List</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">Yield</span> <span class="kt">Int</span> <span class="ow">=</span>
    <span class="k">match</span> <span class="n">xs</span>
    <span class="o">|</span> <span class="kt">Cons</span> <span class="n">x</span> <span class="n">xs</span> <span class="ow">-&gt;</span> <span class="n">yield</span> <span class="n">x</span><span class="p">;</span> <span class="n">traverse</span> <span class="n">xs</span>
    <span class="o">|</span> <span class="kt">None</span> <span class="ow">-&gt;</span> <span class="p">()</span>

<span class="nf">filter</span> <span class="p">(</span><span class="n">k</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">Yield</span> <span class="n">b</span><span class="p">)</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="o">:</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">Yield</span> <span class="n">b</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">k</span> <span class="p">()</span>
    <span class="o">|</span> <span class="n">yield</span> <span class="n">x</span> <span class="ow">-&gt;</span>
        <span class="k">if</span> <span class="n">f</span> <span class="n">x</span> <span class="k">then</span> <span class="n">yield</span> <span class="n">x</span>
        <span class="k">resume</span> <span class="p">()</span>

<span class="nf">iter</span> <span class="p">(</span><span class="n">k</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">Yield</span> <span class="n">b</span><span class="p">)</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="kt">Unit</span><span class="p">)</span> <span class="o">:</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">k</span> <span class="p">()</span>
    <span class="o">|</span> <span class="n">yield</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="p">(</span><span class="n">f</span> <span class="n">x</span><span class="p">)</span>

<span class="nf">yield_to_list</span> <span class="p">(</span><span class="n">k</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">Yield</span> <span class="n">b</span><span class="p">)</span> <span class="o">:</span> <span class="kt">List</span> <span class="n">b</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">k</span> <span class="p">()</span>
    <span class="o">|</span> <span class="k">return</span> <span class="n">_</span> <span class="ow">-&gt;</span> <span class="kt">[]</span>
    <span class="o">|</span> <span class="n">yield</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="kt">Cons</span> <span class="n">x</span> <span class="p">(</span><span class="k">resume</span> <span class="p">())</span>

<span class="nf">main</span> <span class="p">()</span> <span class="ow">=</span>
    <span class="n">odds</span> <span class="ow">=</span> <span class="n">traverse</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">filter</span> <span class="n">is_odd</span>
        <span class="k">with</span> <span class="n">yield_to_list</span>

    <span class="c1">// Above we see a benefit of the with operator over a different</span>
    <span class="c1">// lambda sugar like {foo} for (fn () -&gt; foo). With the later</span>
    <span class="c1">// syntax, nesting is unavoidable:</span>
    <span class="c1">// odds = {{traverse [1, 2, 3]}</span>
    <span class="c1">//     .filter is_odd}</span>
    <span class="c1">//     .yield_to_list</span>

    <span class="n">traverse</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="k">with</span> <span class="n">filter</span> <span class="n">is_odd</span> <span class="k">with</span> <span class="n">iter</span> <span class="k">fn</span> <span class="n">i</span> <span class="ow">-&gt;</span>
        <span class="n">print</span> <span class="s">&#34;yielded $i&#34;</span>
</code></pre></div><h3 id="logging-and-mocking">Logging and Mocking</h3>
<p>The ability to decide effect handlers at the callsite enables
us to swap out the behavior of side-effectful operations to
mock them for testing.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-an" data-lang="an"><span class="k">effect</span> <span class="kt">Print</span> <span class="k">with</span>
    <span class="n">print</span><span class="o">:</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Unit</span>

<span class="k">effect</span> <span class="kt">QueryDatabase</span> <span class="k">with</span>
    <span class="n">querydb</span><span class="o">:</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Response</span>

<span class="nf">database</span> <span class="n">f</span> <span class="ow">=</span>
    <span class="n">db</span> <span class="ow">=</span> <span class="kt">Database</span><span class="o">.</span><span class="n">connect</span> <span class="s">&#34;...&#34;</span>
    <span class="n">result</span> <span class="ow">=</span> <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
        <span class="o">|</span> <span class="n">querydb</span> <span class="n">msg</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="p">(</span><span class="n">send</span> <span class="n">db</span> <span class="n">msg</span><span class="p">)</span>
    <span class="n">close</span> <span class="n">db</span>
    <span class="n">result</span>

<span class="nf">ignore_db</span> <span class="n">f</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="n">querydb</span> <span class="n">_</span> <span class="ow">-&gt;</span> <span class="kt">Response</span><span class="o">.</span><span class="n">empty</span>

<span class="nf">business_logic</span> <span class="p">(</span><span class="n">should_query</span><span class="o">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">Print</span><span class="p">,</span> <span class="kt">QueryDatabase</span> <span class="ow">=</span>
    <span class="k">if</span> <span class="n">should_query</span> <span class="k">then</span>
        <span class="n">print</span> <span class="s">&#34;querying...&#34;</span>
        <span class="n">response</span> <span class="ow">=</span> <span class="n">querydb</span> <span class="s">&#34;SELECT column FROM table&#34;</span>
        <span class="o">...</span>
        <span class="n">print</span> <span class="s">&#34;done with db&#34;</span>
    <span class="k">else</span>
        <span class="n">print</span> <span class="s">&#34;did not query&#34;</span>

<span class="c1">// Print effect handling is builtin, let ante handle it</span>
<span class="nf">main</span> <span class="p">()</span> <span class="k">can</span> <span class="kt">Print</span> <span class="ow">=</span>
    <span class="n">business_logic</span> <span class="kc">true</span> <span class="k">with</span> <span class="n">database</span>

<span class="c1">// Mock our business function. Use a different handler for</span>
<span class="c1">// testing instead of the database handler that will actually</span>
<span class="c1">// connect to the database.</span>
<span class="nf">test</span> <span class="p">()</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">business_logic</span> <span class="kc">false</span>
    <span class="o">|</span> <span class="n">print</span> <span class="n">msg</span> <span class="ow">-&gt;</span> <span class="n">assert</span> <span class="p">(</span><span class="n">msg</span> <span class="o">==</span> <span class="s">&#34;did not query&#34;</span><span class="p">)</span>
    <span class="o">|</span> <span class="n">querydb</span> <span class="n">_</span> <span class="ow">-&gt;</span>
        <span class="n">error</span> <span class="s">&#34;Tried to query when should_query = false!&#34;</span>

    <span class="n">logs</span> <span class="ow">=</span> <span class="n">business_logic</span> <span class="kc">true</span> <span class="k">with</span> <span class="n">ignore_db</span> <span class="k">with</span> <span class="n">collect_prints</span>
    <span class="n">assert</span> <span class="p">(</span><span class="k">not</span> <span class="n">is_empty</span> <span class="n">logs</span><span class="p">)</span>
</code></pre></div><h3 id="expected-value">Expected Value</h3>
<p>One of the more niche benefits of algebraic effects is the ability
to compute the expected value of numerical functions which internally
use an effect like <code>Flip</code> to decide on branches to take within the function.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">effect</span> <span class="kt">Flip</span> <span class="k">with</span>
    <span class="n">flip</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>

<span class="nf">calculation</span> <span class="p">()</span> <span class="ow">=</span>
    <span class="k">if</span> <span class="n">flip</span> <span class="p">()</span> <span class="k">then</span>
        <span class="n">unused</span> <span class="ow">=</span> <span class="n">flip</span> <span class="p">()</span>
        <span class="k">if</span> <span class="n">flip</span> <span class="p">()</span> <span class="k">then</span> <span class="mf">0.5</span>
        <span class="k">else</span> <span class="mf">4.0</span>
    <span class="k">else</span> <span class="mf">1.0</span>

<span class="nf">expected_value</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="kt">F64</span> <span class="k">can</span> <span class="kt">Flip</span><span class="p">)</span> <span class="o">:</span> <span class="kt">F64</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="n">flip</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="k">resume</span> <span class="kc">true</span> <span class="o">+</span> <span class="k">resume</span> <span class="kc">false</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

<span class="nf">print</span> <span class="p">(</span><span class="n">expected_value</span> <span class="n">calculation</span><span class="p">)</span>  <span class="c1">//=&gt; 1.625</span>
</code></pre></div><h3 id="parsers">Parsers</h3>
<p>Algebraic effects can also be used to write parser combinators.
This parser is for a language with numbers, addition, multiplication,
and parenthesized expressions. This example was adapted from
<a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/08/algeff-tr-2016-v2.pdf">this koka paper</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">effect</span> <span class="kt">Repeat</span> <span class="k">with</span>
    <span class="n">flip</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
    <span class="n">fail</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span>

<span class="k">effect</span> <span class="kt">Parse</span> <span class="k">with</span>
    <span class="c1">// The parameter to Satisfy is a function which takes</span>
    <span class="c1">// our current input and returns a pair of</span>
    <span class="c1">// (result, rest_of_input) on success, or None on failure.</span>
    <span class="n">satisfy</span><span class="o">:</span> <span class="p">(</span><span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="kt">String</span><span class="p">))</span> <span class="ow">-&gt;</span> <span class="n">a</span>

<span class="nf">choice</span> <span class="n">p1</span> <span class="n">p2</span> <span class="ow">=</span>
    <span class="k">if</span> <span class="n">flip</span> <span class="p">()</span> <span class="k">then</span> <span class="n">p1</span> <span class="p">()</span> <span class="k">else</span> <span class="n">p2</span> <span class="p">()</span>

<span class="nf">many</span> <span class="p">(</span><span class="n">p</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">Repeat</span><span class="p">)</span> <span class="o">:</span> <span class="kt">List</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">Repeat</span> <span class="ow">=</span>
    <span class="n">choice</span> <span class="p">(</span><span class="k">fn</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="n">many1</span> <span class="n">p</span><span class="p">)</span>
           <span class="p">(</span><span class="k">fn</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="kt">Nil</span><span class="p">)</span>

<span class="nf">many1</span> <span class="n">p</span> <span class="ow">=</span> <span class="kt">Cons</span> <span class="p">(</span><span class="n">p</span> <span class="p">())</span> <span class="p">(</span><span class="n">many</span> <span class="n">p</span><span class="p">)</span>


<span class="c1">// Return all possible solutions from the given computation</span>
<span class="nf">solutions</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">Repeat</span><span class="p">)</span> <span class="o">:</span> <span class="kt">List</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="k">return</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="o">|</span> <span class="n">fail</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="kt">[]</span>
    <span class="o">|</span> <span class="n">flip</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="kc">false</span> <span class="o">++</span> <span class="k">resume</span> <span class="kc">true</span>

<span class="c1">// Return the first succeeding computation (taking the false Flip branch first)</span>
<span class="nf">eager</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">Repeat</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Maybe</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="k">return</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="kt">Some</span> <span class="n">x</span>
    <span class="o">|</span> <span class="n">fail</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="kt">None</span>
    <span class="o">|</span> <span class="n">flip</span> <span class="p">()</span> <span class="ow">-&gt;</span>
        <span class="k">match</span> <span class="k">resume</span> <span class="kc">false</span>
        <span class="o">|</span> <span class="kt">Some</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="kt">Some</span> <span class="n">x</span>
        <span class="o">|</span> <span class="kt">None</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="kc">true</span>

<span class="c1">// Handle any Parse effects (letting Repeat effects pass through)</span>
<span class="nf">parse</span> <span class="p">(</span><span class="n">input</span><span class="o">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">Parse</span><span class="p">,</span> <span class="kt">Repeat</span><span class="p">)</span> <span class="o">:</span> <span class="n">a</span><span class="p">,</span> <span class="kt">String</span> <span class="k">can</span> <span class="kt">Repeat</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="k">return</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">x</span><span class="p">,</span> <span class="n">input</span>
    <span class="o">|</span> <span class="n">satisfy</span> <span class="n">p</span> <span class="ow">-&gt;</span>
        <span class="k">match</span> <span class="n">p</span> <span class="n">input</span>
        <span class="o">|</span> <span class="kt">None</span> <span class="ow">-&gt;</span> <span class="n">fail</span> <span class="p">()</span>
        <span class="o">|</span> <span class="kt">Some</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="n">x</span> <span class="k">with</span> <span class="n">parse</span> <span class="n">rest</span>

<span class="c1">// These will be our parsing primitives</span>
<span class="nf">symbol</span> <span class="p">(</span><span class="n">c</span><span class="o">:</span> <span class="kt">Char</span><span class="p">)</span> <span class="o">:</span> <span class="kt">Char</span> <span class="k">can</span> <span class="kt">Parse</span> <span class="ow">=</span>
    <span class="n">satisfy</span> <span class="k">fn</span> <span class="n">input</span> <span class="ow">-&gt;</span>
        <span class="k">match</span> <span class="n">input</span>
        <span class="o">|</span> <span class="kt">Cons</span> <span class="n">x</span> <span class="n">rest</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="kt">Some</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
        <span class="o">|</span> <span class="n">_</span> <span class="ow">-&gt;</span> <span class="kt">None</span>

<span class="nf">digit</span> <span class="p">()</span> <span class="o">:</span> <span class="kt">Int</span> <span class="k">can</span> <span class="kt">Parse</span> <span class="ow">=</span>
    <span class="n">satisfy</span> <span class="k">fn</span> <span class="n">input</span> <span class="ow">-&gt;</span>
        <span class="k">match</span> <span class="n">input</span>
        <span class="o">|</span> <span class="kt">Cons</span> <span class="n">d</span> <span class="n">rest</span> <span class="k">if</span> <span class="n">is_digit</span> <span class="n">d</span> <span class="ow">-&gt;</span> <span class="kt">Some</span> <span class="p">(</span><span class="n">int</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">),</span> <span class="n">rest</span><span class="p">)</span>
        <span class="o">|</span> <span class="n">_</span> <span class="ow">-&gt;</span> <span class="kt">None</span>

<span class="nf">number</span> <span class="p">()</span> <span class="ow">=</span>
    <span class="n">many1</span> <span class="n">digit</span> <span class="o">.</span><span class="n">foldl</span> <span class="mi">0</span> <span class="k">fn</span> <span class="n">acc</span> <span class="n">d</span> <span class="ow">-&gt;</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">+</span> <span class="n">d</span>

<span class="c1">// Now our actual parser with begin in proper:</span>
<span class="nf">binop</span> <span class="n">sym</span> <span class="n">op</span> <span class="n">f</span> <span class="ow">=</span>
    <span class="n">a</span> <span class="ow">=</span> <span class="n">f</span> <span class="p">()</span>
    <span class="n">symbol</span> <span class="n">sym</span>
    <span class="n">b</span> <span class="ow">=</span> <span class="n">f</span> <span class="p">()</span>
    <span class="n">op</span> <span class="n">a</span> <span class="n">b</span>

<span class="nf">add</span> <span class="p">()</span> <span class="ow">=</span> <span class="n">binop</span> <span class="sc">&#39;+&#39;</span> <span class="p">(</span><span class="o">+</span><span class="p">)</span> <span class="n">term</span>
<span class="nf">mul</span> <span class="p">()</span> <span class="ow">=</span> <span class="n">binop</span> <span class="sc">&#39;*&#39;</span> <span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">factor</span>

<span class="nf">expr</span> <span class="p">()</span> <span class="ow">=</span> <span class="n">choice</span> <span class="n">add</span> <span class="n">term</span>
<span class="nf">term</span> <span class="p">()</span> <span class="ow">=</span> <span class="n">choice</span> <span class="n">mul</span> <span class="n">factor</span>

<span class="nf">factor</span> <span class="p">()</span> <span class="o">:</span> <span class="kt">Int</span> <span class="k">can</span> <span class="kt">Parse</span><span class="p">,</span> <span class="kt">Repeat</span> <span class="ow">=</span>
    <span class="n">choice</span> <span class="n">number</span> <span class="k">fn</span> <span class="p">()</span> <span class="ow">-&gt;</span>
        <span class="n">symbol</span> <span class="sc">&#39;(&#39;</span>
        <span class="n">e</span> <span class="ow">=</span> <span class="n">expr</span> <span class="p">()</span>
        <span class="n">symbol</span> <span class="sc">&#39;)&#39;</span>
        <span class="n">e</span>

<span class="nf">parse</span> <span class="n">expr</span> <span class="s">&#34;1+2*3&#34;</span> <span class="k">with</span> <span class="n">solutions</span>
<span class="c1">//=&gt; [(7, &#34;&#34;), (3, &#34;*3&#34;), (1, &#34;+2*3&#34;)]</span>

<span class="nf">parse</span> <span class="n">expr</span> <span class="s">&#34;1+2*3&#34;</span> <span class="k">with</span> <span class="n">eager</span>
<span class="c1">//=&gt; Some (7, &#34;&#34;)</span>
</code></pre></div><h3 id="others">Others</h3>
<p>Other examples include using effects to
implement <a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2017/05/asynceffects-msr-tr-2017-21.pdf">asynchronous functions</a>, implementing
a clean design for <a href="https://gopiandcode.uk/logs/log-bye-bye-monads-algebraic-effects.html">handling animations in games</a>,
and using effects to emulate any monad except
for the continuation monad (citation needed).</p>
<hr>

                        </div>
                        
                        

                    </div>
                    

                    

                    

                    <div class="col-md-3">

                        

                        <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://antelang.org/"><h1>Ante</h1></a>
    </div>

    
    
    
    
    <div class="table-of-contents toc bd-callout">
        
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/docs/language/#literals">
                        <li>Literals</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#integers">
                        <li>Integers</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#floats">
                        <li>Floats</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#booleans">
                        <li>Booleans</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#characters">
                        <li>Characters</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#strings">
                        <li>Strings</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#string-interpolation">
                        <li>String Interpolation</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/docs/language/#variables">
                        <li>Variables</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#mutability">
                        <li>Mutability</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/docs/language/#functions">
                        <li>Functions</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/docs/language/#type-inference">
                        <li>Type Inference</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/docs/language/#significant-whitespace">
                        <li>Significant Whitespace</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#line-continuations">
                        <li>Line Continuations</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/docs/language/#operators">
                        <li>Operators</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#subscript-operator">
                        <li>Subscript Operator</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#no-dereference-operator">
                        <li>No Dereference Operator</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#pipeline-operators">
                        <li>Pipeline Operators</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#pair-operator">
                        <li>Pair Operator</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/docs/language/#lambdas">
                        <li>Lambdas</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#explicit-currying">
                        <li>Explicit Currying</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/docs/language/#control-flow">
                        <li>Control-Flow</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#loops">
                        <li>Loops</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/docs/language/#pattern-matching">
                        <li>Pattern Matching</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/docs/language/#types">
                        <li>Types</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#type-definitions">
                        <li>Type Definitions</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#type-annotations">
                        <li>Type Annotations</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#int-type">
                        <li>Int Type</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#float-type">
                        <li>Float Type</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#anonymous-struct-types">
                        <li>Anonymous Struct Types</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/docs/language/#move-semantics">
                        <li>Move Semantics</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#borrowing">
                        <li>Borrowing</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                    
                    
                    
                    <a href="/docs/language/#restrictions-on-references">
                        <li>Restrictions on References</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                        <ul class="toc-h4">
                    
                    
                    
                    
                    <a href="/docs/language/#returning-references">
                        <li>Returning References</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                        <ul class="toc-h4">
                    
                    
                    
                    
                    <a href="/docs/language/#lifetime-bound-types">
                        <li>Lifetime-bound Types</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                    
                    
                    
                    <a href="/docs/language/#shared-mutability">
                        <li>Shared Mutability</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                    
                    
                    
                    <a href="/docs/language/#reference-polymorphism">
                        <li>Reference Polymorphism</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                    
                    
                    
                    <a href="/docs/language/#internal-mutability">
                        <li>Internal Mutability</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/docs/language/#traits">
                        <li>Traits</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#impls">
                        <li>Impls</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#named-impls">
                        <li>Named Impls</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#functional-dependencies">
                        <li>Functional Dependencies</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#coherence">
                        <li>Coherence</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/docs/language/#modules">
                        <li>Modules</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#imports">
                        <li>Imports</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#exports-and-visibility">
                        <li>Exports and Visibility</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/docs/language/#packages">
                        <li>Packages</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#diamond-dependencies">
                        <li>Diamond Dependencies</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/docs/language/#extern">
                        <li>Extern</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/docs/language/#algebraic-effects">
                        <li>Algebraic Effects</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#sugar-for-applying-handlers">
                        <li>Sugar for applying handlers</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#more-on-handlers">
                        <li>More on Handlers</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                    
                    
                    
                    <a href="/docs/language/#multiple-handlers">
                        <li>Multiple Handlers</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                    
                    
                    
                    <a href="/docs/language/#matching-on-the-returned-value">
                        <li>Matching on the Returned Value</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                    
                    
                    
                    <a href="/docs/language/#resuming-multiple-times">
                        <li>Resuming Multiple Times</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                    
                    
                    
                    <a href="/docs/language/#resuming-zero-times">
                        <li>Resuming Zero Times</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#error-handling">
                        <li>Error Handling</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/docs/language/#useful-effects">
                        <li>Useful Effects</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                    
                    
                    
                    <a href="/docs/language/#state">
                        <li>State</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                    
                    
                    
                    <a href="/docs/language/#imperative-programming">
                        <li>Imperative Programming</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                    
                    
                    
                    <a href="/docs/language/#generators">
                        <li>Generators</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                    
                    
                    
                    <a href="/docs/language/#logging-and-mocking">
                        <li>Logging and Mocking</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                    
                    
                    
                    <a href="/docs/language/#expected-value">
                        <li>Expected Value</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                    
                    
                    
                    <a href="/docs/language/#parsers">
                        <li>Parsers</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                        <ul class="toc-h3">
                    
                    
                    
                    
                    <a href="/docs/language/#others">
                        <li>Others</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
    </div>
    


    <p>&copy; 2024. All rights reserved. </p>
  </div>
</div>


                        

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        <footer id="footer">
    <div class="container">

        

        <div class="col-md-4 col-sm-6">

            
            <h4>Recent posts</h4>

            <div class="blog-entries">
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://antelang.org/blog/simplification_through_addition/">
                          
                            <img src="/img/banners/antelope_canyon.jpg" class="img-responsive" alt="Simplification Through Addition">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://antelang.org/blog/simplification_through_addition/">Simplification Through Addition</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://antelang.org/blog/effects_ownership_and_borrowing/">
                          
                            <img src="/img/banners/anteater2.jpg" class="img-responsive" alt="Algebraic Effects, Ownership, and Borrowing">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://antelang.org/blog/effects_ownership_and_borrowing/">Algebraic Effects, Ownership, and Borrowing</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://antelang.org/blog/safe_shared_mutability/">
                          
                            <img src="/img/banners/antelope_bird.jpg" class="img-responsive" alt="Achieving Safe, Aliasable Mutability with Unboxed Types">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://antelang.org/blog/safe_shared_mutability/">Achieving Safe, Aliasable Mutability with Unboxed Types</a></h5>
                    </div>
                </div>
                
            </div>

            <hr class="hidden-md hidden-lg">
            

        </div>
        

        

    </div>
    
</footer>







<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-right">
              Template by <a href="https://bootstrapious.com/p/universal-business-e-commerce-template">Bootstrapious</a>.
              

              Ported to Hugo by <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>.
            </p>
        </div>
    </div>
</div>





    </div>
    

    
<script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>

<script src="https://antelang.org/js/front.js"></script>


<script src="https://antelang.org/js/owl.carousel.min.js"></script>


  </body>
</html>
