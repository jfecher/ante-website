<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Algebraic Effects, Ownership, and Borrowing</title>
<meta name="author" content="Jake Fecher" />




<meta name="keywords" content="ante, programming, language, antelang, lang">


<meta name="description" content="">

<meta name="generator" content="Hugo 0.89.0-DEV" />


<link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>


<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.11.2/css/all.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link href="/css/animate.css" rel="stylesheet">



  <link href="/css/style.red.css" rel="stylesheet" id="theme-stylesheet">



<link href="/css/custom.css" rel="stylesheet">



  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->



<link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />


<link href="/css/owl.carousel.css" rel="stylesheet">
<link href="/css/owl.theme.css" rel="stylesheet">


<link rel="alternate" href="https://antelang.org/index.xml" type="application/rss+xml" title="Ante">








<meta property="og:locale" content="en_us">
<meta property="og:site_name" content="Ante">
<meta property="og:title" content="Algebraic Effects, Ownership, and Borrowing">
<meta property="og:type" content="article">
<meta property="og:url" content="https://antelang.org/blog/effects_ownership_and_borrowing/" />
<meta property="og:description" content="">
<meta property="og:image" content="https://antelang.org/img/banners/anteater2.jpg">
<meta property="og:image:type" content="image/jpg">



  <meta property="og:image:width" content="960">
  <meta property="og:image:height" content="640">


<meta property="og:updated_time" content="2024-02-20T00:00:00Z">

  
  
  <meta property="article:section" content="effects">
  
  
  <meta property="article:published_time" content="2024-02-20T00:00:00Z">
  <meta property="article:modified_time" content="2024-02-20T00:00:00Z">



<meta name="twitter:card" content="summary_large_image">

<meta name="twitter:title" content="Algebraic Effects, Ownership, and Borrowing">

<meta name="twitter:image" content="https://antelang.org/img/banners/anteater2.jpg">

<meta name="twitter:description" content="">


      <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Algebraic Effects, Ownership, and Borrowing</title>
  <meta name="author" content="" />

  <meta name="keywords" content="ante, programming, language, antelang, lang">	
  <meta name="description" content="For exploring algebraic effects, safe shared mutability, and other novel features">

  <meta name="generator" content="Hugo 0.89.0-DEV" />

  <link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  
  <link href="https://antelang.org/css/animate.css" rel="stylesheet">

  
  
    <link href="https://antelang.org/css/style.red.css" rel="stylesheet" id="theme-stylesheet">
  


  
  <link href="https://antelang.org/css/custom.css" rel="stylesheet">
 
  
  <link rel="stylesheet" href="https://antelang.org/css/syntax.css">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="https://antelang.org/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="https://antelang.org/img/apple-touch-icon.png" />
  

  <link href="https://antelang.org/css/owl.carousel.css" rel="stylesheet">
  <link href="https://antelang.org/css/owl.theme.css" rel="stylesheet">

  <link rel="alternate" href="https://antelang.org/index.xml" type="application/rss+xml" title="Ante">

  
  <meta property="og:title" content="Algebraic Effects, Ownership, and Borrowing" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://antelang.org/blog/effects_ownership_and_borrowing//" />
  <meta property="og:image" content="" />

  </head>

  <body>

    <div id="all">

        


        

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="https://antelang.org/">
                    <img src="https://antelang.org/img/ante_white.svg" width="90rem" alt="Algebraic Effects, Ownership, and Borrowing" class="hidden-xs hidden-sm">
                    <img src="https://antelang.org/img/ante_white.svg" width="90rem" alt="Algebraic Effects, Ownership, and Borrowing" class="visible-xs visible-sm">
                    <span class="sr-only">Algebraic Effects, Ownership, and Borrowing - go to homepage</span>
                </a>
                
<div class="navbar-buttons">
        <div class="navbar-collapse collapse" id="navigation">
            <ul class="nav navbar-nav navbar-right">
            
            <li class="dropdown">
                <a href="https://antelang.org//docs/language">Documentation</a>
            </li>
            <li class="dropdown">
                <a href="https://antelang.org//docs/ideas">Ideas</a>
            </li>
            <li class="dropdown">
                <a href="https://antelang.org//docs/roadmap">Roadmap</a>
            </li>
            <li class="dropdown">
                <a href="https://antelang.org//blog">Blog</a>
            </li>

            <li class="dropdown">
                <a href="https://github.com/jfecher/ante"><i class="fa fa-15x fa-github"></i></a>
            </li>
            <li class="dropdown">
                <a href="https://reddit.com/r/ante"><i class="fab fa-15x fa-reddit"></i></a>
            </li>
            <li class="dropdown">
                <a href="https://discord.gg/NPJncGBAws"><i class="fab fa-15x fa-discord"></i></a>
            </li>
            <li class="dropdown">
                <a href="https://antelang.org//index.xml"><i class="fa fa-15x fa-rss"></i></a>
            </li>

            </ul>
        </div>
        <button type="button" class="navbar-toggle btn-template-main" onclick="document.getElementById('navigation').classList.toggle('collapse')">
    <span class="sr-only">Toggle Navigation</span>
        <i class="fa fa-align-justify"></i>
    </button>
</div>

            </div>
            

            
            

            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    






        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Algebraic Effects, Ownership, and Borrowing</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">

                <div class="row">

                    

                    <div class="col-md-9" id="blog-post">

                        
                          <p class="text-muted text-uppercase mb-small text-right">
                            
			      By <a href="/authors/jake-fecher">Jake Fecher</a>
                            
                            
                            
                              
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                                  
                              
                              2024-02-20
                            
                          </p>
                        

                        <div id="post-content">
                          <hr>
<h1 id="introduction">Introduction</h1>
<p><a href="/docs/language/#algebraic-effects">Algebraic Effects</a> are a useful abstraction
for reasoning about effectful programs by letting us leave the interpretation
of these effects to callers. However, most existing literature discusses these
in the context of a pure functional language with pervasive sharing of values.
What restrictions would we need to introduce algebraic effects into a language
with ownership and borrowing - particularly Ante?<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<hr>
<h1 id="ownership">Ownership</h1>
<p>Consider the following program:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">effect</span> <span class="kt">Read</span> <span class="n">a</span> <span class="k">with</span>
    <span class="n">read</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span>

<span class="nf">the_value</span> <span class="p">(</span><span class="n">value</span><span class="o">:</span> <span class="n">a</span><span class="p">)</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="k">can</span> <span class="kt">Read</span> <span class="n">a</span><span class="p">)</span> <span class="o">:</span> <span class="n">b</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="n">read</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="n">value</span>
</code></pre></div><p>This seems like it&rsquo;d pass type checking at first glance, but we can easily
construct a program that tries to use the same moved value twice:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">foo</span> <span class="p">()</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">Read</span> <span class="kt">String</span> <span class="ow">=</span>
    <span class="n">s1</span> <span class="ow">=</span> <span class="n">read</span> <span class="p">()</span>
    <span class="n">s2</span> <span class="ow">=</span> <span class="n">read</span> <span class="p">()</span>

<span class="nf">foo</span> <span class="p">()</span> <span class="k">with</span> <span class="n">the_value</span> <span class="s">&#34;foo&#34;</span>

<span class="c1">// The above is sugar for</span>
<span class="c1">// the_value &#34;foo&#34; (fn () -&gt; foo ())</span>
</code></pre></div><p>Since a handler&rsquo;s body may be called multiple times, it may not move any
value in its environment. This restriction is similar to moving values in a loop:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">the_value</span> <span class="p">(</span><span class="n">value</span><span class="o">:</span> <span class="n">a</span><span class="p">)</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="k">can</span> <span class="kt">Read</span> <span class="n">a</span><span class="p">)</span> <span class="o">:</span> <span class="n">b</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="c1">// Error: Handler body moves `value` which will still</span>
    <span class="c1">//         be needed if the handler is called again</span>
    <span class="o">|</span> <span class="n">read</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="n">value</span>
</code></pre></div><hr>
<h1 id="borrowing">Borrowing</h1>
<p>Things get more complicated when we consider borrowing. Although Ante&rsquo;s references
<a href="/docs/language/#borrowing">do not have explicit lifetime variables</a>,
we still need to ensure their lifetime is sound.</p>
<h2 id="returning-owning-references">Returning Owning References</h2>
<p>Consider the following program:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">bad</span> <span class="p">()</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">Read</span> <span class="p">(</span><span class="o">&amp;</span><span class="k">own</span> <span class="k">mut</span> <span class="kt">Box</span> <span class="kt">String</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">s1</span> <span class="ow">=</span> <span class="n">read</span> <span class="p">()</span>

    <span class="c1">// Uh-oh, we&#39;ve just obtained a second mutable owning reference to the same String</span>
    <span class="n">s2</span> <span class="ow">=</span> <span class="n">read</span> <span class="p">()</span>
    <span class="n">s2_inner_ref</span> <span class="ow">=</span> <span class="n">as_ref</span> <span class="n">s2</span>

    <span class="c1">// Drop the old Box referenced by s1 and s2</span>
    <span class="n">s1</span> <span class="o">:=</span> <span class="kt">Box</span><span class="o">.</span><span class="n">of</span> <span class="s">&#34;foo&#34;</span>

    <span class="c1">// And now we&#39;re printing a dangling reference</span>
    <span class="n">print</span> <span class="n">s2_inner_ref</span>

<span class="nf">the_ref</span> <span class="p">(</span><span class="kt">ref</span><span class="o">:</span> <span class="o">&amp;</span><span class="k">own</span> <span class="k">mut</span> <span class="n">t</span><span class="p">)</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">Read</span> <span class="p">(</span><span class="o">&amp;</span><span class="k">own</span> <span class="k">mut</span> <span class="n">t</span><span class="p">))</span> <span class="o">:</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="n">read</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="kt">ref</span>

<span class="nf">my_string</span> <span class="ow">=</span> <span class="k">mut</span> <span class="kt">Box</span><span class="o">.</span><span class="n">of</span> <span class="s">&#34;bar&#34;</span>
<span class="nf">bad</span> <span class="p">()</span> <span class="k">with</span> <span class="n">the_ref</span> <span class="o">&amp;</span><span class="n">my_string</span>
</code></pre></div><p>This breaks the aliasing restriction on <code>&amp;own mut</code> in a way the compiler
cannot verify with existing rules on tracking lifetimes.</p>
<p>The solution to this is that each function using the same <code>Read (&amp;own mut Box String)</code>
effect is considered to borrow from the same effect handler. Attempting to retrieve
two owned, mutable references from the same handler then would be a lifetime error:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">bad</span> <span class="p">()</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">Read</span> <span class="p">(</span><span class="o">&amp;</span><span class="k">own</span> <span class="k">mut</span> <span class="kt">Box</span> <span class="kt">String</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">s1</span> <span class="ow">=</span> <span class="n">read</span> <span class="p">()</span>

    <span class="c1">// Error: Cannot create a new aliased reference with `s1` still in scope</span>
    <span class="n">s2</span> <span class="ow">=</span> <span class="n">read</span> <span class="p">()</span>

    <span class="n">print</span> <span class="n">s1</span>
</code></pre></div><p>Similarly, trying to obfuscate this by calling a function which indirectly
returns another reference should also fail:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">indirect</span> <span class="p">()</span> <span class="k">can</span> <span class="kt">Read</span> <span class="p">(</span><span class="o">&amp;</span><span class="k">own</span> <span class="k">mut</span> <span class="kt">Box</span> <span class="kt">String</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">read</span> <span class="p">()</span>

<span class="nf">foo</span> <span class="p">()</span> <span class="k">can</span> <span class="kt">Read</span> <span class="p">(</span><span class="o">&amp;</span><span class="k">own</span> <span class="k">mut</span> <span class="kt">Box</span> <span class="kt">String</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">r1</span> <span class="ow">=</span> <span class="n">read</span> <span class="p">()</span>

    <span class="c1">// Error: Cannot borrow from `Read` effect again with `r1` still in scope</span>
    <span class="n">r2</span> <span class="ow">=</span> <span class="n">indirect</span> <span class="p">()</span>
</code></pre></div><h2 id="owned-reference-parameters">Owned Reference Parameters</h2>
<p>Now let&rsquo;s consider how we can break programs which pass references to effects.
For this we&rsquo;re going to use the <code>Yield a</code> effect which is used for creating
generators or streams:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">effect</span> <span class="kt">Yield</span> <span class="n">a</span> <span class="k">with</span>
    <span class="n">yield</span><span class="o">:</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Unit</span>

<span class="nf">foo</span> <span class="p">()</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">Yield</span> <span class="p">(</span><span class="o">&amp;</span><span class="k">own</span> <span class="k">mut</span> <span class="kt">I32</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">vec</span> <span class="ow">=</span> <span class="k">mut</span> <span class="kt">Vec</span><span class="o">.</span><span class="n">of</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">yield</span> <span class="p">(</span><span class="n">get_mut</span> <span class="o">&amp;</span><span class="n">vec</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">vec</span> <span class="o">:=</span> <span class="kt">Vec</span><span class="o">.</span><span class="n">of</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">yield</span> <span class="p">(</span><span class="n">get_mut</span> <span class="o">&amp;</span><span class="n">vec</span> <span class="mi">0</span><span class="p">)</span>

<span class="nf">bar</span> <span class="p">()</span> <span class="ow">=</span>
    <span class="n">x</span> <span class="ow">=</span> <span class="k">mut</span> <span class="kt">None</span>

    <span class="k">handle</span> <span class="n">foo</span> <span class="p">()</span>
    <span class="o">|</span> <span class="n">yield</span> <span class="n">y</span> <span class="ow">-&gt;</span>
        <span class="k">if</span> <span class="kt">Some</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">x</span> <span class="k">then</span>
            <span class="c1">// foo has cleared the underlying vec by this point,</span>
            <span class="c1">// so this would print a dangling reference!</span>
            <span class="n">print</span> <span class="n">x</span>

        <span class="n">x</span> <span class="o">:=</span> <span class="kt">Some</span> <span class="n">y</span>
        <span class="k">resume</span> <span class="p">()</span>
</code></pre></div><p>To prevent this we need to tie <code>y</code> to the variable that owns it - which is <code>resume</code>.
This way we can still yield owned references if needed, but we cannot call <code>resume</code> until they are dropped.</p>
<p>Conceptually, we can think of a handle expression as receiving a single <code>resume</code> object which
is then unpacked:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">handle</span> <span class="n">foo</span> <span class="p">()</span>
<span class="o">|</span> <span class="kt">MyEffect</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span>
    <span class="o">...</span>

<span class="c1">// Conceptually the same as:</span>
<span class="k">handle</span> <span class="n">foo</span> <span class="p">()</span>
<span class="o">|</span> <span class="kt">MyEffect</span> <span class="k">resume</span> <span class="ow">-&gt;</span>
    <span class="n">a</span> <span class="ow">=</span> <span class="k">resume</span><span class="o">.</span><span class="n">a</span>
    <span class="n">b</span> <span class="ow">=</span> <span class="k">resume</span><span class="o">.</span><span class="n">b</span>
    <span class="k">resume</span> <span class="ow">=</span> <span class="k">resume</span><span class="o">.</span><span class="n">continuation</span>
    <span class="o">...</span>
</code></pre></div><hr>
<h1 id="resume">Resume</h1>
<p>One core aspect of effects that we&rsquo;ve glossed over so far is the <code>resume</code> function
which resumes an effectful computation from the handler. Since <code>resume</code> refers to an
in-progress computation, we need a way to safely encode this environment, yet we
need to do so when defining the effect before the environment is known.
What type should be given to <code>resume</code>?</p>
<p>Consider the following code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">effect</span> <span class="kt">Fork</span> <span class="k">with</span>
    <span class="n">fork</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>

<span class="nf">foo</span> <span class="p">()</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">Fork</span> <span class="ow">=</span>
    <span class="n">message</span> <span class="ow">=</span> <span class="s">&#34;branch&#34;</span>

    <span class="k">if</span> <span class="n">fork</span> <span class="p">()</span> <span class="k">then</span>
        <span class="n">print</span> <span class="s">&#34;${message} A&#34;</span>
        <span class="n">drop</span> <span class="n">message</span>
    <span class="k">else</span>
        <span class="n">print</span> <span class="s">&#34;${message} B&#34;</span>

<span class="nf">handle_fork</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">Fork</span><span class="p">)</span> <span class="o">:</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="n">fork</span> <span class="p">()</span> <span class="ow">-&gt;</span>
        <span class="c1">// Run `resume` twice, arbitrarily returning the second result</span>
        <span class="k">resume</span> <span class="kc">true</span>
        <span class="k">resume</span> <span class="kc">false</span>

<span class="nf">handle_fork</span> <span class="n">foo</span>
</code></pre></div><p>After resuming from the <code>fork</code> the second time, we enter the false branch.
When doing so, <code>message</code> has already been moved, so we&rsquo;d be reading from an
already-dropped value.</p>
<p>This is the problem the different closure types already solve. We just need
some way to determine if <code>resume</code> should be a <code>Fn</code>, <code>FnMut</code>, or <code>FnOnce</code> since
we cannot know this within the handler itself.</p>
<p>One possibility is to require this in the definition of <code>Fork</code> itself:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">effect</span> <span class="kt">Fork</span> <span class="k">with</span>
    <span class="n">fork</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>

    <span class="c1">// The underscores here are because we&#39;re omitting the closure environment</span>
    <span class="c1">// type as well as the actual function type - which is derived from fork&#39;s type.</span>
    <span class="c1">// Although the environment type can be specified if desired, the function type of resume</span>
    <span class="c1">// must be omitted because its return type will be the handler type, which is</span>
    <span class="c1">// not known at this point.</span>
    <span class="n">fork</span><span class="o">.</span><span class="k">resume</span><span class="o">:</span> <span class="kt">FnMut</span> <span class="n">_</span> <span class="n">_</span>
</code></pre></div><p>Note that <code>fork</code> itself is still callable without restrictions.
It is only <code>resume</code> that will be a <code>FnMut</code> when it is introduced.</p>
<p>Anyways, now we&rsquo;d get an error when writing <code>foo</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">foo</span> <span class="p">()</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">Fork</span> <span class="ow">=</span>
    <span class="n">message</span> <span class="ow">=</span> <span class="s">&#34;branch&#34;</span>

    <span class="c1">// Error: `fork` can be resumed multiple times, but `message` would</span>
    <span class="c1">//         possibly be moved after the first call to `resume`.</span>
    <span class="k">if</span> <span class="n">fork</span> <span class="p">()</span> <span class="k">then</span>
        <span class="n">print</span> <span class="s">&#34;${message} A&#34;</span>
        <span class="c1">// Note: `message` is moved here</span>
        <span class="n">drop</span> <span class="n">message</span>
    <span class="k">else</span>
        <span class="n">print</span> <span class="s">&#34;${message} B&#34;</span>
</code></pre></div><p>Since this error would otherwise be much more common, <code>resume</code> is by
default a <code>FnOnce</code> unless otherwise specified. This means when defining
an effect we will need to think about what kinds of effect handlers we
want to permit.</p>
<p>Also note that after removing <code>drop</code>, <code>message</code> will not be dropped at the
end of <code>foo</code>. Instead, it is part of <code>resume</code>&rsquo;s environment and will be dropped
after the last use of <code>resume</code> in the effect handler.</p>
<h2 id="environment-type-quantification">Environment Type Quantification</h2>
<p>Most effects which give an explicit type for <code>resume</code> will either omit the
environment type, or specify it as a type variable quantified over the function:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">effect</span> <span class="kt">Foo</span> <span class="k">with</span>
    <span class="n">foo</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="kt">Unit</span>
    <span class="n">foo</span><span class="o">.</span><span class="k">resume</span><span class="o">:</span> <span class="kt">FnOnce</span> <span class="n">env</span> <span class="n">_</span>

    <span class="c1">// The above means:</span>
    <span class="c1">// foo.resume: forall env. FnOnce env _</span>
</code></pre></div><p>This is generally desired since it allows the <code>resume</code> closure to be unboxed most
of the time. However, what would happen if the user wrote the trait as the following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">effect</span> <span class="kt">Foo</span> <span class="n">env</span> <span class="k">with</span>
    <span class="n">foo</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="kt">Unit</span>
    <span class="n">foo</span><span class="o">.</span><span class="k">resume</span><span class="o">:</span> <span class="kt">FnOnce</span> <span class="n">env</span> <span class="n">_</span>
</code></pre></div><p>Since each generic instance of a trait would be separate (e.g. <code>Read I32</code> versus <code>Read String</code>),
each use of this effect with a different environment would be a separate effect:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">forced_example</span> <span class="p">(</span><span class="n">x</span><span class="o">:</span> <span class="o">&amp;</span><span class="kt">I32</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">foo</span> <span class="p">()</span>
    <span class="n">y</span> <span class="ow">=</span> <span class="n">x</span>
    <span class="n">foo</span> <span class="p">()</span>
    <span class="n">print</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div><p>Above, <code>forced_example</code> would be inferred to have the effects <code>Foo Env1</code> and <code>Foo Env2</code> where
<code>Env1</code> and <code>Env2</code> are both opaque types representing the environments. Since each of these would
need to be handled by separate effect handlers, this technique could be used to limit an effect
to being called at most once per handler. It remains to be seen how useful this would be however.</p>
<h2 id="restricting-the-environment-type">Restricting the environment type</h2>
<p>If any capabilities are required on the <code>resume</code> closure, a <code>given</code> clause can be added.
Since most traits on closures are defined as long as they&rsquo;re defined on the closure environment,
it is usually sufficient to require the trait on the closure environment alone:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">effect</span> <span class="kt">Foo</span> <span class="k">with</span>
    <span class="n">foo</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="kt">Unit</span>
    <span class="n">foo</span><span class="o">.</span><span class="k">resume</span><span class="o">:</span> <span class="kt">FnOnce</span> <span class="n">env</span> <span class="n">_</span> <span class="k">given</span> <span class="kt">Clone</span> <span class="n">env</span>
</code></pre></div><p>Note that since <code>resume</code> is a continuation, this environment type includes any captured variables
across other function calls as well. So the <code>Clone</code> constraint above would also apply to
the <code>vec</code> variable below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">inner_fn</span> <span class="p">()</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">Foo</span> <span class="ow">=</span>
    <span class="c1">// x may be cloned</span>
    <span class="n">x</span> <span class="ow">=</span> <span class="mi">3</span>
    <span class="n">foo</span> <span class="p">()</span>
    <span class="n">print</span> <span class="n">x</span>

<span class="nf">outer_fn</span> <span class="p">()</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">Foo</span> <span class="ow">=</span>
    <span class="c1">// vec may also be cloned</span>
    <span class="n">vec</span> <span class="ow">=</span> <span class="kt">Vec</span><span class="o">.</span><span class="n">of</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">function2</span> <span class="p">()</span>
    <span class="n">print</span> <span class="n">vec</span>
</code></pre></div><p>Since environment types can grow quite large, it is generally recommended to avoid cloning
<code>resume</code>. A more useful trait constraint on <code>resume</code> is covered in the next section.</p>
<hr>
<h1 id="multithreading">Multithreading</h1>
<p>Going back to the <code>Fork</code> example, what would happen if we tried to run each
resumption in its own thread?</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">effect</span> <span class="kt">Fork</span> <span class="k">with</span>
    <span class="n">fork</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>

    <span class="c1">// Changed to Fn so that we can alias this twice below</span>
    <span class="n">fork</span><span class="o">.</span><span class="k">resume</span><span class="o">:</span> <span class="kt">Fn</span> <span class="n">env</span> <span class="n">_</span>

<span class="nf">multithread_fork</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">Fork</span><span class="p">)</span> <span class="o">:</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="n">fork</span> <span class="p">()</span> <span class="ow">-&gt;</span>
        <span class="c1">// Spawn two threads and wait for them both to complete</span>
        <span class="kt">Thread</span><span class="o">.</span><span class="n">wait</span> <span class="k">fn</span> <span class="p">()</span> <span class="ow">-&gt;</span>
            <span class="c1">// Error: Expected argument of `Thread.spawn` to be `Send`</span>
            <span class="c1">//        No impl found for `Send (Fn _ (Unit -&gt; Bool))`</span>
            <span class="kt">Thread</span><span class="o">.</span><span class="n">spawn</span> <span class="p">(</span><span class="k">fn</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="kc">true</span><span class="p">)</span>
            <span class="kt">Thread</span><span class="o">.</span><span class="n">spawn</span> <span class="p">(</span><span class="k">fn</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="kc">false</span><span class="p">)</span>
</code></pre></div><p>In order to spawn a new thread to call <code>resume</code> we&rsquo;d need to require
the reference to the function is <code>Send</code>. For closures, we can do this easily
by requiring the environment is <code>Send</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">effect</span> <span class="kt">Fork</span> <span class="k">with</span>
    <span class="n">fork</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
    <span class="n">foo</span><span class="o">.</span><span class="k">resume</span><span class="o">:</span> <span class="kt">Fn</span> <span class="n">env</span> <span class="n">_</span> <span class="k">given</span> <span class="kt">Send</span> <span class="o">&amp;</span><span class="n">env</span>

<span class="nf">multithread_fork</span> <span class="p">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="k">can</span> <span class="kt">Fork</span><span class="p">)</span> <span class="o">:</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="k">handle</span> <span class="n">f</span> <span class="p">()</span>
    <span class="o">|</span> <span class="n">fork</span> <span class="p">()</span> <span class="ow">-&gt;</span>
        <span class="kt">Thread</span><span class="o">.</span><span class="n">wait</span> <span class="k">fn</span> <span class="p">()</span> <span class="ow">-&gt;</span>
            <span class="kt">Thread</span><span class="o">.</span><span class="n">spawn</span> <span class="p">(</span><span class="k">fn</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="kc">true</span><span class="p">)</span>
            <span class="kt">Thread</span><span class="o">.</span><span class="n">spawn</span> <span class="p">(</span><span class="k">fn</span> <span class="p">()</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="kc">false</span><span class="p">)</span>
</code></pre></div><hr>
<h1 id="implementation-details-and-boxing">Implementation Details and Boxing</h1>
<p>Different implementations of effects can have wildly different runtime costs.</p>
<p>For example, most languages implementing the full spectrum of algebraic effects
will keep track of the stack of effect handlers at runtime. When an effect call
is made, a lookup needs to be performed then the code needs to jump to the relevant
handler and back.</p>
<p>Languages without algebraic effects aren&rsquo;t completely free from the costs of effects
either though. Even if we restrict ourselves to just the <code>async</code> effect, we can
see how common such an effect is throughout many languages - yet each tends to
have its own unique implementation with its own performance characteristics.</p>
<p>Consider Rust&rsquo;s <code>async</code> effect which is implented by compiling async functions
to state machines. In this scheme, the following code is rejected:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">recursive</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">recursive</span><span class="p">().</span><span class="k">await</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="n">recursive</span><span class="p">().</span><span class="k">await</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>Because the resulting state machine would have infinite size:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="k">enum</span> <span class="nc">Recursive</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">First</span><span class="p">(</span><span class="n">Recursive</span><span class="p">),</span><span class="w">
</span><span class="w">    </span><span class="n">Second</span><span class="p">(</span><span class="n">Recursive</span><span class="p">),</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>To get around this, users need to box recursive functions:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">futures</span>::<span class="n">future</span>::<span class="p">{</span><span class="n">BoxFuture</span><span class="p">,</span><span class="w"> </span><span class="n">FutureExt</span><span class="p">};</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">recursive</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">BoxFuture</span><span class="o">&lt;&#39;</span><span class="nb">static</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="k">move</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">recursive</span><span class="p">().</span><span class="k">await</span><span class="p">;</span><span class="w">
</span><span class="w">        </span><span class="n">recursive</span><span class="p">().</span><span class="k">await</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="p">}.</span><span class="n">boxed</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>If we try to implement a similar example in future-Ante<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">effect</span> <span class="kt">Async</span> <span class="k">with</span>
    <span class="n">await</span><span class="o">:</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="kt">Unit</span>

<span class="nf">recursive</span> <span class="p">()</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="k">can</span> <span class="kt">Await</span> <span class="ow">=</span>
    <span class="c1">// This doesn&#39;t quite match the semantics of the Rust example above,</span>
    <span class="c1">// but lets us use a simpler definition for `await`</span>
    <span class="n">await</span> <span class="p">()</span>
    <span class="n">recursive</span> <span class="p">()</span>
    <span class="n">await</span> <span class="p">()</span>
    <span class="n">recursive</span> <span class="p">()</span>

<span class="k">handle</span> <span class="n">recursive</span> <span class="p">()</span>
<span class="o">|</span> <span class="n">await</span> <span class="n">f</span> <span class="ow">-&gt;</span> <span class="k">resume</span> <span class="p">()</span>
</code></pre></div><p>The result would look quite different:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">recursive</span> <span class="p">()</span> <span class="o">:</span> <span class="kt">Unit</span> <span class="ow">=</span>
    <span class="n">recursive</span> <span class="p">()</span>
    <span class="n">recursive</span> <span class="p">()</span>
</code></pre></div><p>So theoretically no boxing is needed for recursion alone.
The performance characteristics here look quite different - but that is
because in Ante they&rsquo;re largely determined by the handler that is used
rather than the callsite of the effect. If we use a different handler
which does not resume in a tail position, boxing will be required.
For example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="k">handle</span> <span class="n">recursive</span> <span class="p">()</span>
<span class="o">|</span> <span class="n">await</span> <span class="n">f</span> <span class="ow">-&gt;</span>
    <span class="k">resume</span> <span class="p">(</span><span class="n">f</span> <span class="p">())</span>
    <span class="n">print</span> <span class="s">&#34;done&#34;</span>
</code></pre></div><p>Compiles to<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ante" data-lang="ante"><span class="nf">recursive</span> <span class="n">k</span> <span class="ow">=</span>
    <span class="n">recursive</span> <span class="k">fn</span> <span class="p">()</span> <span class="ow">-&gt;</span>
      <span class="n">recursive</span> <span class="n">k</span>
      <span class="n">print</span> <span class="s">&#34;done&#34;</span>
    <span class="n">print</span> <span class="s">&#34;done&#34;</span>
</code></pre></div><p>Here we can see the inner continuation captures the outer continuation <code>k</code>.</p>
<p>To give <code>k</code> a valid type, we&rsquo;d need to box it to ensure it always has the
same size for each recursive call. This is similar to what we&rsquo;d need to do
in the Rust example, but there are some unique problems with requiring users manually
box these continuations in Ante:</p>
<ul>
<li>The continuation is added by the compiler, so it isn&rsquo;t clear to the user where
they should add the boxing.</li>
<li>Whether boxing is required is dependent on the structure of the handler. We don&rsquo;t
want to always add boxing since tail-resume is the more common case.</li>
</ul>
<p>We could try to get around this by marking whether a given effect must have a tail-resumptive
handler or not, and requiring recursive functions using non-tail-resumptive handlers to
box their continuations somehow. This would make effects much more cumbersome to use however,
and one of Ante&rsquo;s goals is to be a slightly <em>higher</em> level language than Rust. If effects are
not simple to use then users will avoid them.</p>
<p>For these reasons, the current plan is for the compiler to automatically insert boxing
of closures where appropriate and infer their lifetimes via <a href="/docs/ideas/#lifetime-inference">lifetime inference</a>.
Lifetime inference is a very interesting topic to me - it was one of Ante&rsquo;s original goals
to experiment with it. When it works well it can be great since it can stack-allocate
potentially even to prior stack frames. The downside is that the inferred lifetimes can be imprecise.
Although, in this case, if lifetimes cannot be accurately inferred, we would still know
their longest possible lifetime is that of the effect handler.<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>
This is a topic that deserves much more detail though so I&rsquo;ll leave it to a future
blog post. If you&rsquo;re still curious, there are some papers on it reachable from the documentation link above.</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Note that ownership &amp; borrowing are a recent addition to Ante and the changes in this article
are not yet reflected in the documentation!&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>Getting the desired output here requires an optimization for <code>resume</code> in a tail position,
which is not currently implemented.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>This output has been heavily cleaned.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4" role="doc-endnote">
<p>This is because effects are implemented via delimited continuations which are evaluated at compile-time.
Ante takes this approach from Effekt and it is further detailed in <a href="https://se.cs.uni-tuebingen.de/publications/schuster19zero.pdf">Zero-cost Effect Handlers by Staging</a>&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

                        </div>
                        
                        

                    </div>
                    

                    

                    

                    <div class="col-md-3">

                        

                        <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://antelang.org/"><h1>Ante</h1></a>
    </div>

    
    
    
    
    <div class="table-of-contents toc bd-callout">
        
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/blog/effects_ownership_and_borrowing/#introduction">
                        <li>Introduction</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/blog/effects_ownership_and_borrowing/#ownership">
                        <li>Ownership</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/blog/effects_ownership_and_borrowing/#borrowing">
                        <li>Borrowing</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/blog/effects_ownership_and_borrowing/#returning-owning-references">
                        <li>Returning Owning References</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/blog/effects_ownership_and_borrowing/#owned-reference-parameters">
                        <li>Owned Reference Parameters</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/blog/effects_ownership_and_borrowing/#resume">
                        <li>Resume</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/blog/effects_ownership_and_borrowing/#environment-type-quantification">
                        <li>Environment Type Quantification</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                        <ul class="toc-h2">
                    
                    
                    
                    
                    <a href="/blog/effects_ownership_and_borrowing/#restricting-the-environment-type">
                        <li>Restricting the environment type</li>
                    </a>
                    
                    
                        </ul>
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/blog/effects_ownership_and_borrowing/#multithreading">
                        <li>Multithreading</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
            
            
                
                    
                    
                    
                        <ul class="toc-h1">
                    
                    
                    
                    
                    <a href="/blog/effects_ownership_and_borrowing/#implementation-details-and-boxing">
                        <li>Implementation Details and Boxing</li>
                    </a>
                    
                    
                        </ul>
                    
                
            
        
    </div>
    


    <p>&copy; 2024. All rights reserved. </p>
  </div>
</div>


                        

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        <footer id="footer">
    <div class="container">

        

        <div class="col-md-4 col-sm-6">

            
            <h4>Recent posts</h4>

            <div class="blog-entries">
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://antelang.org/blog/effects_ownership_and_borrowing/">
                          
                            <img src="/img/banners/anteater2.jpg" class="img-responsive" alt="Algebraic Effects, Ownership, and Borrowing">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://antelang.org/blog/effects_ownership_and_borrowing/">Algebraic Effects, Ownership, and Borrowing</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://antelang.org/blog/safe_shared_mutability/">
                          
                            <img src="/img/banners/antelope_bird.jpg" class="img-responsive" alt="Achieving Safe, Aliasable Mutability with Unboxed Types">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://antelang.org/blog/safe_shared_mutability/">Achieving Safe, Aliasable Mutability with Unboxed Types</a></h5>
                    </div>
                </div>
                
            </div>

            <hr class="hidden-md hidden-lg">
            

        </div>
        

        

    </div>
    
</footer>







<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-right">
              Template by <a href="https://bootstrapious.com/p/universal-business-e-commerce-template">Bootstrapious</a>.
              

              Ported to Hugo by <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>.
            </p>
        </div>
    </div>
</div>





    </div>
    

    
<script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>

<script src="https://antelang.org/js/front.js"></script>


<script src="https://antelang.org/js/owl.carousel.min.js"></script>


  </body>
</html>
